(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-59fb206e"],{"0ea0":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{style:e.style})},r=[],o=(n("6b54"),n("c5f6"),n("492e")),l={props:{width:{type:[String,Number],default:"100%"},height:{type:[String,Number],default:"500"},code:{type:String,default:"// code \n"},language:{type:String,default:"javascript"},theme:{type:String,default:"vs-dark"},options:{type:Object,default:function(){}},fileName:""},mounted:function(){this.createMonaco()},destroyed:function(){for(var e=0;e<this.toDispose.length;e++)this.toDispose[e].dispose();this.editor&&this.editor.dispose()},computed:{style:function(){var e=this.width,t=this.height,n=-1!==e.toString().indexOf("%")?e:"".concat(e,"px"),i=-1!==t.toString().indexOf("%")?t:"".concat(t,"px");return{width:n,height:i}},editorOptions:function(){return Object.assign({},this.defaults,this.options,{value:this.code,language:this.language,theme:this.theme,model:this.model})}},data:function(){return{defaults:{selectOnLineNumbers:!0,roundedSelection:!1,readOnly:!1,cursorStyle:"line",automaticLayout:!0,glyphMargin:!0,folding:!0,renderIndentGuides:!0,minimap:{enabled:!1}},toDispose:[],breakpoints:[],breakline:[]}},methods:{initValue:function(e){this.editor.setValue(e)},createModel:function(e,t){return o["b"].editor.createModel(e,t)},setModel:function(e,t){this.editor.setModel(e),t&&this.editor.restoreViewState(t)},setReadonly:function(e){this.editor.updateOptions({readOnly:e})},saveViewState:function(){return this.editor.saveViewState()},getValue:function(){return this.editor.getValue()},getPosition:function(){return this.editor.getPosition()},setPosition:function(e){this.editor.setPosition(e)},getPositionAt:function(e){return this.editor.getModel().getPositionAt(e)},addCommand:function(e,t){this.editor.addCommand(e,t)},focus:function(){this.editor.focus()},createMonaco:function(e){var t=this;this.editor=o["b"].editor.create(this.$el,this.editorOptions);var n=this.editor.getModel();n.fileName=this.fileName,this.toDispose.push(this.editor.onDidChangeModelContent((function(e){t.$emit("codeChanged",e)}))),this.toDispose.push(this.editor.onMouseDown(this.onMouseDown)),this.$emit("mounted",this.editor)},onMouseDown:function(e){if(2===e.target.type&&!e.target.detail.isAfterLines){var t=this.getLineBreakpoint(e.target.position.lineNumber);if(-1!==t){var n=this.breakpoints[t];this.breakpoints.splice(t,1),this.editor.deltaDecorations([n],[])}else{var i=this.editor.deltaDecorations([],[{range:e.target.range,options:{isWholeLine:!0,glyphMarginClassName:"breakpoint"}}]);this.breakpoints=this.breakpoints.concat(i)}}},getLineBreakpoint:function(e){for(var t=0;t<this.breakpoints.length;t++){var n=this.breakpoints[t],i=this.editor.getModel().getDecorationRange(n);if(i.startLineNumber===e)return t}return-1},getBreakpoints:function(){for(var e=[],t=0;t<this.breakpoints.length;t++){var n=this.breakpoints[t],i=this.editor.getModel().getDecorationRange(n);e.push({id:n,line:i.startLineNumber})}return e},highlightBreakline:function(e){this.breakline=e>0?this.editor.deltaDecorations(this.breakline,[{range:new o["b"].Range(e,1,e,1),options:{isWholeLine:!0,className:"breakline"}}]):this.editor.deltaDecorations(this.breakline,[])}}},s=l,a=(n("2f2b"),n("2877")),u=Object(a["a"])(s,i,r,!1,null,null,null);t["a"]=u.exports},"14b0":function(e,t,n){},1946:function(e,t,n){},"1fd8":function(e,t,n){},"20d6":function(e,t,n){"use strict";var i=n("5ca1"),r=n("0a49")(6),o="findIndex",l=!0;o in[]&&Array(1)[o]((function(){l=!1})),i(i.P+i.F*l,"Array",{findIndex:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}}),n("9c6c")(o)},"2f2b":function(e,t,n){"use strict";var i=n("1fd8"),r=n.n(i);r.a},"3bdf":function(e,t,n){"use strict";var i=n("e2f5"),r=n.n(i);r.a},"3f5c":function(e,t,n){"use strict";n.r(t);var i,r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticStyle:{height:"100%"}},[n("div",{staticClass:"header"},[n("span",[e._v(e._s(e.storeTitle))]),n("el-radio-group",{staticStyle:{"margin-left":"40px"},attrs:{fill:"#0994ff",size:"small"},model:{value:e.activeView,callback:function(t){e.activeView=t},expression:"activeView"}},e._l(e.views,(function(t){return n("el-radio-button",{key:t.label,attrs:{label:t.label}},[e._v(e._s(t.title))])})),1),e._v(" "),n("el-button-group",{directives:[{name:"show",rawName:"v-show",value:"members"===e.activeView,expression:"activeView==='members'"}]},[n("el-button",{attrs:{size:"small",icon:"el-icon-circle-plus"},on:{click:e.onAddMember}},[e._v("Add")]),n("el-button",{attrs:{disabled:null==e.currentMember,size:"small",icon:"el-icon-remove"},on:{click:e.onRemoveMember}},[e._v("Remove")]),n("el-button",{attrs:{disabled:null==e.currentMember,size:"small",icon:"fas fa-edit"},on:{click:e.onRenameMember}},[e._v(" Rename")]),n("el-button",{attrs:{disabled:null==e.currentMember,size:"small",icon:"fas fa-link"},on:{click:e.onFindUsages}},[e._v(" Usages")])],1)],1),n("div",{staticClass:"content"},[n("ex-splitter",{directives:[{name:"show",rawName:"v-show",value:"members"===e.activeView,expression:"activeView==='members'"}],attrs:{minSize:300,handlerColor:"#f1f1f1",size:300}},[n("el-table",{ref:"memberTable",staticClass:"members",attrs:{slot:"panel1",data:e.members,height:"100%",stripe:"","highlight-current-row":"",border:""},on:{"current-change":e.currentRowChange},slot:"panel1"},[n("el-table-column",{attrs:{prop:"Name",label:"Name",width:"180",align:"center"}}),n("el-table-column",{attrs:{prop:"Type",formatter:e.entityMemberTypeFormat,label:"Type",width:"180",align:"center"}}),n("el-table-column",{attrs:{prop:"AllowNull",label:"AllowNull",width:"180",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-checkbox",{attrs:{disabled:""},model:{value:t.row.AllowNull,callback:function(n){e.$set(t.row,"AllowNull",n)},expression:"scope.row.AllowNull"}})]}}])}),n("el-table-column",{attrs:{prop:"Comment",label:"Comment",align:"center"}})],1),n("div",{staticClass:"ide-property-panel",attrs:{slot:"panel2"},slot:"panel2"},[n("el-collapse",{staticClass:"ide-property-collapse",attrs:{value:e.collapseValue}},[n("el-collapse-item",{attrs:{title:"Entity Properties",name:"1"}},[n("el-form",{attrs:{"label-position":"right",size:"mini","label-width":"120px"}},[n("el-form-item",{attrs:{label:"ID"}},[n("el-input",{attrs:{disabled:!0},model:{value:e.target.ID,callback:function(t){e.$set(e.target,"ID",t)},expression:"target.ID"}})],1),n("el-form-item",{attrs:{label:"Comment"}},[n("el-input",{attrs:{disabled:!0},model:{value:e.target.Comment,callback:function(t){e.$set(e.target,"Comment",t)},expression:"target.Comment"}})],1),n("el-form-item",{attrs:{label:"AppID"}},[n("el-input",{attrs:{disabled:!0},model:{value:e.target.AppID,callback:function(t){e.$set(e.target,"AppID",t)},expression:"target.AppID"}})],1),n("el-form-item",{attrs:{label:"Model Name"}},[n("el-input",{attrs:{disabled:!0},model:{value:e.target.Text,callback:function(t){e.$set(e.target,"Text",t)},expression:"target.Text"}})],1),n("el-form-item",{attrs:{label:"SortNo"}},[n("el-input",{attrs:{disabled:!0},model:{value:e.target.SortNo,callback:function(t){e.$set(e.target,"SortNo",t)},expression:"target.SortNo"}})],1),n("el-form-item",{attrs:{label:"ToString"}},[n("el-button",{staticStyle:{width:"100%"},on:{click:e.onOpenExpressionEditor}},[e._v("Edit Expression")])],1)],1)],1),null!==e.currentMemberTitle?n("el-collapse-item",{attrs:{title:e.currentMemberTitle,name:"2"}},[n(e.currentMemberDesigner,{tag:"component",attrs:{member:e.currentMember,owner:e.target},on:{"update:member":function(t){e.currentMember=t}}})],1):e._e()],1)],1)],1),"sysopts"===e.activeView?n("sys-store-options",{ref:"sysoptsView",attrs:{target:e.target,members:e.members,options:e.options}}):e._e(),"sqlopts"===e.activeView?n("sql-store-options",{ref:"sqloptsView",attrs:{target:e.target,members:e.members,options:e.options}}):e._e(),"cqlopts"===e.activeView?n("cql-store-options",{ref:"cqloptsView",attrs:{target:e.target,members:e.members,options:e.options}}):e._e(),"data"===e.activeView?n("entity-data-view",{ref:"dataView",attrs:{target:e.target,members:e.members}}):e._e()],1),e.expressionDialog?n(e.expressionDialog,{tag:"component",attrs:{ownerType:"EntityModel",ownerID:e.target.ID,propertyName:"ToStringExpression"},on:{close:e.onCloseExpressionEditor}}):e._e()],1)},o=[],l=(n("7514"),n("2b0e")),s=n("ff57"),a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-form",{attrs:{model:e.member,"label-position":"right",size:"mini","label-width":"120px"}},[n("el-form-item",{attrs:{prop:"Name",label:"Name"}},[n("el-input",{attrs:{disabled:!0,value:e.member.Name}})],1),n("el-form-item",{attrs:{label:"Comment"}},[n("el-input",{on:{change:function(t){return e.changeProp("Comment")}},model:{value:e.member.Comment,callback:function(t){e.$set(e.member,"Comment",t)},expression:"member.Comment"}})],1),n("el-form-item",{attrs:{prop:"DataType",required:!0,label:"DataType"}},[n("el-select",{attrs:{disabled:!e.canEditType},on:{change:function(t){return e.changeProp("DataType")}},model:{value:e.member.DataType,callback:function(t){e.$set(e.member,"DataType",t)},expression:"member.DataType"}},e._l(e.DataFieldTypes,(function(e){return n("el-option",{key:e.value,attrs:{label:e.text,value:e.value}})})),1)],1),8===e.member.DataType?n("el-form-item",{attrs:{prop:"EnumModelID",required:!0,label:"EnumModelID"}},[n("el-select",{attrs:{placeholder:"Enums"},on:{change:function(t){return e.changeProp("EnumModelId")}},model:{value:e.member.EnumModelID,callback:function(t){e.$set(e.member,"EnumModelID",t)},expression:"member.EnumModelID"}},e._l(e.enums,(function(e){return n("el-option",{key:e.ID,attrs:{label:e.ID,value:e.ID}})})),1)],1):e._e(),e.canEditLength?n("el-form-item",{attrs:{prop:"Length",required:!0,label:"Length"}},[n("el-input",{on:{change:function(t){return e.changeProp("Length")}},model:{value:e.member.Length,callback:function(t){e.$set(e.member,"Length",t)},expression:"member.Length"}})],1):e._e(),e.canEditDecimals?n("el-form-item",{attrs:{label:"Scale"}},[n("el-input",{on:{change:function(t){return e.changeProp("Decimals")}},model:{value:e.member.Decimals,callback:function(t){e.$set(e.member,"Decimals",t)},expression:"member.Decimals"}})],1):e._e(),e.canEditAllowNull?n("el-form-item",{attrs:{label:"AllowNull"}},[n("el-checkbox",{on:{change:function(t){return e.changeProp("AllowNull")}},model:{value:e.member.AllowNull,callback:function(t){e.$set(e.member,"AllowNull",t)},expression:"member.AllowNull"}})],1):e._e()],1)},u=[],c=(n("7f7f"),[{text:"String",value:1},{text:"DateTime",value:2},{text:"UInt16",value:3},{text:"Int16",value:4},{text:"UInt32",value:5},{text:"Int32",value:6},{text:"UInt64",value:7},{text:"Int64",value:8},{text:"Decimal",value:9},{text:"Boolean",value:10},{text:"Guid",value:11},{text:"Byte",value:12},{text:"Binary",value:13},{text:"Enum",value:14},{text:"Float",value:15},{text:"Double",value:16}]),m=n("d836"),d=n("7aa8"),p={data:function(){return{DataFieldTypes:c,enums:[],suspendChanges:!1}},props:{member:{type:Object,required:!0},owner:{type:Object,required:!0}},watch:{member:function(e,t){this.suspendChanges=!0;var n=this;this.$nextTick((function(){n.suspendChanges=!1}))}},computed:{canEditType:function(){return this.owner.StoreId&&0!=this.owner.StoreId&&1!=this.member.DataType},canEditLength:function(){return this.owner.StoreId&&0!=this.owner.StoreId&&(1==this.member.DataType||9==this.member.DataType)},canEditDecimals:function(){return this.owner.StoreId&&0!=this.owner.StoreId&&9==this.member.DataType},canEditAllowNull:function(){return this.owner.StoreId&&0!=this.owner.StoreId}},methods:{loadEnums:function(){this.enums=s["a"].tree.getAllModelNodes(m["a"].EnumModelNode,d["a"].Enum)},changeProp:function(e){if(!this.suspendChanges){var t=this,n=[this.owner.ID,this.member.Name,e,this.member[e]];$runtime.channel.invoke("sys.DesignService.ChangeEntityMember",n).catch((function(e){t.$message.error(e)}))}}},mounted:function(){this.loadEnums()}},h=p,f=n("2877"),b=Object(f["a"])(h,a,u,!1,null,null,null),y=b.exports,g=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-form",{attrs:{model:e.member,size:"mini","label-position":"right","label-width":"120px"}},[n("el-form-item",{attrs:{prop:"Name",label:"Name"}},[n("el-input",{attrs:{disabled:!0},model:{value:e.Name,callback:function(t){e.Name=t},expression:"Name"}})],1),n("el-form-item",{attrs:{label:"Comment"}},[n("el-input",{model:{value:e.Comment,callback:function(t){e.Comment=t},expression:"Comment"}})],1),n("el-form-item",{attrs:{label:"RefModelIds"}},[n("el-select",{attrs:{multiple:!0,disabled:!0},model:{value:e.RefModelIds,callback:function(t){e.RefModelIds=t},expression:"RefModelIds"}},e._l(e.RefModelIds,(function(e){return n("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),n("el-form-item",{attrs:{label:"Delete Action"}},[n("el-select",{attrs:{disabled:e.member.IsAggregationRef},model:{value:e.DeleteRule,callback:function(t){e.DeleteRule=t},expression:"DeleteRule"}},e._l(e.DeleteRules,(function(e){return n("el-option",{key:e.value,attrs:{label:e.text,value:e.value}})})),1)],1),n("el-form-item",{attrs:{label:"AllowNull"}},[n("el-checkbox",{attrs:{disabled:""},model:{value:e.AllowNull,callback:function(t){e.AllowNull=t},expression:"AllowNull"}})],1)],1)},v=[],D=[{text:"NoAction",value:0},{text:"Cascade",value:1},{text:"SetNull",value:2}],w={data:function(){return{DeleteRules:D,Name:this.member.Name,Comment:this.member.Comment,RefModelIds:this.member.RefModelIds,DeleteRule:this.member.DeleteRule,AllowNull:this.member.AllowNull}},watch:{member:function(e){this.Name=e.Name,this.Comment=e.Comment,this.RefModelIDs=e.RefModelIDs},Comment:function(e,t){this.propertyChanged("Comment",e)},DeleteRule:function(e,t){this.propertyChanged("DeleteRule",e)},AllowNull:function(e,t){this.propertyChanged("AllowNull",e)}},props:{member:{type:Object,required:!0},owner:{type:Object,required:!0}},methods:{propertyChanged:function(e,t){var n=this,i=this,r=[this.owner.ID,this.Name,e,t];$runtime.channel.invoke("sys.DesignService.ChangeEntityMember",r).then((function(i){n.$emit("PropertyChanged",e,t)})).catch((function(e){i.$message.error(e)}))}}},I=w,x=Object(f["a"])(I,g,v,!1,null,null,null),M=x.exports,C=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-form",{attrs:{model:e.member,size:"mini","label-position":"right","label-width":"120px"}},[n("el-form-item",{attrs:{prop:"Name",label:"Name"}},[n("el-input",{attrs:{disabled:!0},model:{value:e.Name,callback:function(t){e.Name=t},expression:"Name"}})],1),n("el-form-item",{attrs:{label:"Comment"}},[n("el-input",{model:{value:e.Comment,callback:function(t){e.Comment=t},expression:"Comment"}})],1),n("el-form-item",{attrs:{label:"RefModelID"}},[n("el-input",{attrs:{disabled:!0},model:{value:e.RefModelID,callback:function(t){e.RefModelID=t},expression:"RefModelID"}})],1)],1)},N=[],k={data:function(){return{Name:this.member.Name,Comment:this.member.Comment,RefModelID:this.member.RefModelID}},watch:{member:function(e){this.Name=e.Name,this.Comment=e.Comment,this.RefModelID=e.RefModelID},Comment:function(e,t){this.propertyChanged("Comment",e)}},props:{member:{type:Object,required:!0},owner:{type:Object,required:!0}},methods:{propertyChanged:function(e,t){var n=this,i=this;$runtime.channel.invoke("sys.DesignService.ChangeEntityMember",[this.owner.ID,this.Name,e,t]).then((function(i){n.$emit("PropertyChanged",e,t)})).catch((function(e){i.$message.error(e)}))}},mounted:function(){}},P=k,K=Object(f["a"])(P,C,N,!1,null,null,null),$=K.exports,S=function(e){return e?[{text:"DataField",value:0}]:[{text:"DataField",value:0},{text:"EntityRef",value:2},{text:"EntitySet",value:3}]};(function(e){e[e["ApplicationID"]=0]="ApplicationID",e[e["EntityModelID"]=1]="EntityModelID",e[e["EntityMemberName"]=2]="EntityMemberName",e[e["EntityActionName"]=3]="EntityActionName",e[e["ServiceModelID"]=4]="ServiceModelID",e[e["ServiceMethodName"]=5]="ServiceMethodName",e[e["EnumModelID"]=6]="EnumModelID",e[e["EnumModelItemName"]=7]="EnumModelItemName",e[e["FormModelID"]=8]="FormModelID",e[e["ReportModelID"]=9]="ReportModelID",e[e["WorkflowModelID"]=10]="WorkflowModelID",e[e["PermissionModelID"]=11]="PermissionModelID",e[e["ResourceModelID"]=12]="ResourceModelID",e[e["MenuFolderID"]=13]="MenuFolderID",e[e["MenuItemID"]=14]="MenuItemID",e[e["EventModelID"]=15]="EventModelID"})(i||(i={}));var E,O=i,_=n("492e"),T=n("6a0c"),R=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"view"},[n("h3",[e._v("Partitions:")]),n("el-button-group",[n("el-button",{attrs:{type:"primary",icon:"el-icon-circle-plus",size:"small"},on:{click:function(t){e.addPKDlgVisible=!0}}},[e._v("Add")]),n("el-button",{attrs:{type:"primary",icon:"el-icon-remove",size:"small"},on:{click:e.removePartitionKey}},[e._v("Remove")])],1),n("el-table",{attrs:{data:e.options.PartitionKeys,"highlight-current-row":"",border:"","empty-text":" "},on:{"current-change":e.onCurrentPKChanged}},[n("el-table-column",{attrs:{prop:"MemberId",label:"Name",width:"300",formatter:e.pkNameFormat}}),n("el-table-column",{attrs:{prop:"Rule",label:"Rule",formatter:e.pkRuleFormat}}),n("el-table-column",{attrs:{prop:"OrderByDesc",label:"OrderByDesc",width:"180",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-checkbox",{attrs:{disabled:""},model:{value:t.row.OrderByDesc,callback:function(n){e.$set(t.row,"OrderByDesc",n)},expression:"scope.row.OrderByDesc"}})]}}])})],1),n("h3",[e._v("Indexs:")]),n("el-button-group",[n("el-button",{attrs:{type:"primary",icon:"el-icon-circle-plus",size:"small"},on:{click:function(t){e.addIndexDlgVisible=!0}}},[e._v("Add")]),n("el-button",{attrs:{type:"primary",icon:"el-icon-remove",size:"small"},on:{click:e.removeIndex}},[e._v("Remove")])],1),n("el-table",{attrs:{data:e.options.Indexes,"highlight-current-row":"",border:"","empty-text":" "},on:{"current-change":e.onCurrentIndexChanged}},[n("el-table-column",{attrs:{prop:"Name",label:"Name",width:"300"}}),n("el-table-column",{attrs:{prop:"Fields",label:"Fields",formatter:e.indexFieldsFormat}}),n("el-table-column",{attrs:{prop:"Unique",label:"Unique",width:"180",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-checkbox",{attrs:{disabled:""},model:{value:t.row.Unique,callback:function(n){e.$set(t.row,"Unique",n)},expression:"scope.row.Unique"}})]}}])}),n("el-table-column",{attrs:{prop:"State",label:"State",width:"180",align:"center"}})],1),n("el-dialog",{attrs:{title:"Add PartitionKey",visible:e.addPKDlgVisible},on:{"update:visible":function(t){e.addPKDlgVisible=t}}},[n("el-form",{attrs:{"label-width":"100px",size:"small"},model:{value:e.newPartitionKey,callback:function(t){e.newPartitionKey=t},expression:"newPartitionKey"}},[n("el-form-item",{attrs:{label:"Member:"}},[n("el-select",{model:{value:e.newPartitionKey.MemberId,callback:function(t){e.$set(e.newPartitionKey,"MemberId",t)},expression:"newPartitionKey.MemberId"}},e._l(e.allPartitionKeys,(function(t){return n("el-option",{key:t.MemberId,attrs:{value:t.MemberId,label:t.Name,disabled:e.disabledMember(t.MemberId)}})})),1)],1),n("el-form-item",{attrs:{label:"Rule:"}},[n("el-select",{on:{change:e.onRuleChanged},model:{value:e.newPartitionKey.Rule,callback:function(t){e.$set(e.newPartitionKey,"Rule",t)},expression:"newPartitionKey.Rule"}},e._l(e.allPKRules,(function(t){return n("el-option",{key:t.Id,attrs:{value:t.Id,label:t.Name,disabled:e.disableRule(t)}})})),1)],1),1===e.newPartitionKey.Rule?n("el-form-item",{attrs:{label:"Hash Num:"}},[n("el-select",{key:"s-hashnums",model:{value:e.newPartitionKey.RuleArg,callback:function(t){e.$set(e.newPartitionKey,"RuleArg",t)},expression:"newPartitionKey.RuleArg"}},e._l(e.hashNums,(function(e){return n("el-option",{key:e,attrs:{value:e}})})),1)],1):e._e(),2===e.newPartitionKey.Rule?n("el-form-item",{attrs:{label:"Range:"}},[n("el-select",{key:"s-periods",model:{value:e.newPartitionKey.RuleArg,callback:function(t){e.$set(e.newPartitionKey,"RuleArg",t)},expression:"newPartitionKey.RuleArg"}},e._l(e.allDatePeriods,(function(e){return n("el-option",{key:e.Id,attrs:{value:e.Id,label:e.Name}})})),1)],1):e._e(),n("el-form-item",{attrs:{label:"OrderByDesc:"}},[n("el-switch",{attrs:{"active-text":"DESC","inactive-text":"ASC"},model:{value:e.newPartitionKey.OrderByDesc,callback:function(t){e.$set(e.newPartitionKey,"OrderByDesc",t)},expression:"newPartitionKey.OrderByDesc"}})],1)],1),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.addPKDlgVisible=!1}}},[e._v("Cancel")]),n("el-button",{attrs:{type:"primary"},on:{click:e.addPartitionKey}},[e._v("OK")])],1)],1),n("el-dialog",{attrs:{title:"Add Index",visible:e.addIndexDlgVisible,width:"500px"},on:{"update:visible":function(t){e.addIndexDlgVisible=t}}},[n("el-form",{attrs:{model:e.newIndex,"label-width":"100px",size:"small"}},[n("el-form-item",{attrs:{prop:"Name",label:"Name:"}},[n("el-input",{model:{value:e.newIndex.Name,callback:function(t){e.$set(e.newIndex,"Name",t)},expression:"newIndex.Name"}})],1),n("el-form-item",{attrs:{label:"Fields:"}},[n("el-select",{staticStyle:{width:"100%"},attrs:{"value-key":"MID",multiple:""},model:{value:e.newIndex.Fields,callback:function(t){e.$set(e.newIndex,"Fields",t)},expression:"newIndex.Fields"}},e._l(e.members,(function(e){return n("el-option",{key:e.ID,attrs:{label:e.Name,value:{Name:e.Name,MID:e.ID,OrderByDesc:!1}}})})),1)],1),n("el-form-item",{attrs:{label:"Orders:"}},e._l(e.newIndex.Fields,(function(t){return n("span",{key:t.MID},[e._v(e._s(t.Name)+": "),n("el-switch",{attrs:{"active-text":"DESC","inactive-text":"ASC"},model:{value:t.OrderByDesc,callback:function(n){e.$set(t,"OrderByDesc",n)},expression:"item.OrderByDesc"}}),n("br")],1)})),0),n("el-form-item",{attrs:{label:""}},[n("el-checkbox",{model:{value:e.newIndex.Unique,callback:function(t){e.$set(e.newIndex,"Unique",t)},expression:"newIndex.Unique"}},[e._v("Unique")])],1)],1),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.addIndexDlgVisible=!1}}},[e._v("Cancel")]),n("el-button",{attrs:{type:"primary"},on:{click:e.addIndex}},[e._v("OK")])],1)],1)],1)},A=[];n("ac6a"),n("20d6");(function(e){e[e["None"]=0]="None",e[e["Hash"]=1]="Hash",e[e["RangeOfDate"]=2]="RangeOfDate"})(E||(E={}));var V=E,q=(n("5c96"),{props:{target:{type:Object,required:!0},members:{type:Array,required:!0},options:{type:Object,required:!0}},computed:{allPartitionKeys:function(){var e=[];e.push({MemberId:0,Name:"CreateTime",OrderByDesc:!1});for(var t=0;t<this.members.length;t++)0===this.members[t].Type&&e.push({MemberId:this.members[t].ID,Name:this.members[t].Name,OrderByDesc:!1});return e},allPKRules:function(){var e=[];return e.push({Id:V.None,Name:"None"}),e.push({Id:V.Hash,Name:"Hash"}),e.push({Id:V.RangeOfDate,Name:"RangeOfDate"}),e},allDatePeriods:function(){var e=[];return e.push({Id:0,Name:"Year"}),e.push({Id:1,Name:"Month"}),e.push({Id:2,Name:"Day"}),e}},data:function(){return{addPKDlgVisible:!1,addIndexDlgVisible:!1,newPartitionKey:{MemberId:0,Rule:V.None,RuleArg:0,OrderByDesc:!1},newIndex:{Name:"",Unique:!1,Fields:[]},currentPartitionKey:null,currentIndex:null,oldPartitionKeys:[],hashNums:[2,4,8,16,32,64,128]}},methods:{pkNameFormat:function(e,t,n){return 0===n?"CreateTime":this.members.find((function(e){return e.ID===n})).Name},pkRuleFormat:function(e,t,n){if(n===V.None)return"None";if(n===V.Hash)return"Hash("+e.RuleArg+")";switch(e.RuleArg){case 0:return"Year()";case 1:return"Month()";default:return"Day()"}},indexFieldsFormat:function(e,t,n){for(var i=this,r="",o=function(e){var t=n[e];0!==e&&(r+="; "),r+=i.members.find((function(e){return e.ID===t.MID})).Name+" ",r+=t.OrderByDesc?"DESC":"ASC"},l=0;l<n.length;l++)o(l);return r},onRuleChanged:function(){this.newPartitionKey.RuleArg=this.newPartitionKey.Rule===V.Hash?4:0},onCurrentPKChanged:function(e,t){this.currentPartitionKey=e},onCurrentIndexChanged:function(e,t){this.currentIndex=e},disabledMember:function(e){return!!this.options.PartitionKeys.find((function(t){return t.MemberId===e}))},disableRule:function(e){var t=this;if(e.Id==V.RangeOfDate){if(0===this.newPartitionKey.MemberId)return!1;var n=this.members.find((function(e){return e.ID===t.newPartitionKey.MemberId}));return!(0===n.Type&&2===n.DataType)}return!1},addPartitionKey:function(){this.addPKDlgVisible=!1,this.options.PartitionKeys.push(Object.assign({},this.newPartitionKey)),this.onPartitionKeysChanged()},removePartitionKey:function(){var e=this;if(this.currentPartitionKey){var t=this.options.PartitionKeys.findIndex((function(t){return t.MemberId===e.currentPartitionKey.MemberId}));this.options.PartitionKeys.splice(t,1),this.onPartitionKeysChanged()}else this.$message("Please select partition key first!")},onPartitionKeysChanged:function(e){var t=[this.target.ID,"PartitionKeys",JSON.stringify(this.options.PartitionKeys)],n=this;$runtime.channel.invoke("sys.DesignService.ChangeEntity",t).then((function(e){n.oldPartitionKeys=n.options.PartitionKeys.slice(),n.members.forEach((function(e){n.options.PartitionKeys.find((function(t){return t.MemberId===e.ID}))&&(e.AllowNull=!1)}))})).catch((function(e){n.options.PartitionKeys=n.oldPartitionKeys,n.$message.error("Change PartitionKeys error: "+e)}))},addIndex:function(){if(this.addIndexDlgVisible=!1,this.newIndex.Name)if(0!==this.newIndex.Fields.length){var e=[this.target.ID,"AddIndex",JSON.stringify(this.newIndex)],t=this;$runtime.channel.invoke("sys.DesignService.ChangeEntity",e).then((function(e){t.options.Indexes.push(e)})).catch((function(e){t.$message.error("Add index error: "+e)}))}else this.$message.error("Index has no fields");else this.$message.error("Index has no name")},removeIndex:function(){if(this.currentIndex){var e=this;this.$msgbox.confirm("Are you sure to drop selected index？","Confirm",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then((function(){var t=[e.target.ID,"RemoveIndex",e.currentIndex.ID],n=e;$runtime.channel.invoke("sys.DesignService.ChangeEntity",t).then((function(e){var t=n.options.Indexes.findIndex((function(e){return e.ID===n.currentIndex.ID}));n.options.Indexes.splice(t,1)})).catch((function(e){n.$message.error("Drop index error:"+e)}))})).catch((function(){}))}else this.$message("Please select index first!")}},mounted:function(){this.oldPartitionKeys=this.options.PartitionKeys.slice()}}),F=q,B=(n("cdc6"),Object(f["a"])(F,R,A,!1,null,"4b0d7a81",null)),z=B.exports,j=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"view"},[n("h3",[e._v("PrimaryKeys:")]),n("el-button-group",[n("el-button",{attrs:{type:"primary",icon:"el-icon-circle-plus",size:"small"},on:{click:function(t){e.addPKDlgVisible=!0}}},[e._v("Add")]),n("el-button",{attrs:{type:"primary",icon:"el-icon-remove",size:"small"},on:{click:e.removePrimaryKey}},[e._v("Remove")])],1),n("el-table",{attrs:{data:e.options.PrimaryKeys,"highlight-current-row":"",border:"","empty-text":" "},on:{"current-change":e.onCurrentPKChanged}},[n("el-table-column",{attrs:{prop:"MemberId",label:"Name",formatter:e.pkNameFormat}}),n("el-table-column",{attrs:{prop:"OrderByDesc",label:"OrderByDesc",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-checkbox",{attrs:{disabled:""},model:{value:t.row.OrderByDesc,callback:function(n){e.$set(t.row,"OrderByDesc",n)},expression:"scope.row.OrderByDesc"}})]}}])})],1),n("h3",[e._v("Indexs:")]),n("el-button-group",[n("el-button",{attrs:{type:"primary",icon:"el-icon-circle-plus",size:"small"},on:{click:function(t){e.addIndexDlgVisible=!0}}},[e._v("Add")]),n("el-button",{attrs:{type:"primary",icon:"el-icon-remove",size:"small"},on:{click:e.removeIndex}},[e._v("Remove")])],1),n("el-table",{attrs:{data:e.options.Indexes,"highlight-current-row":"",border:"","empty-text":" "},on:{"current-change":e.onCurrentIndexChanged}},[n("el-table-column",{attrs:{prop:"Name",label:"Name",width:"300",align:"center"}}),n("el-table-column",{attrs:{prop:"Fields",label:"Fields",formatter:e.indexFieldsFormat}}),n("el-table-column",{attrs:{prop:"Unique",label:"Unique",width:"180",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-checkbox",{attrs:{disabled:""},model:{value:t.row.Unique,callback:function(n){e.$set(t.row,"Unique",n)},expression:"scope.row.Unique"}})]}}])})],1),n("el-dialog",{attrs:{title:"Add PrimaryKeys",visible:e.addPKDlgVisible},on:{"update:visible":function(t){e.addPKDlgVisible=t}}},[n("el-form",{attrs:{"label-width":"100px",size:"small"},model:{value:e.newPrimaryKey,callback:function(t){e.newPrimaryKey=t},expression:"newPrimaryKey"}},[n("el-form-item",{attrs:{label:"Member:"}},[n("el-select",{model:{value:e.newPrimaryKey.ID,callback:function(t){e.$set(e.newPrimaryKey,"ID",t)},expression:"newPrimaryKey.ID"}},e._l(e.members,(function(t){return n("el-option",{key:t.ID,attrs:{value:t.ID,label:t.Name,disabled:e.disabledMember(t.ID)}})})),1)],1),n("el-form-item",{attrs:{label:"OrderByDesc:"}},[n("el-switch",{attrs:{"active-text":"DESC","inactive-text":"ASC"},model:{value:e.newPrimaryKey.OrderByDesc,callback:function(t){e.$set(e.newPrimaryKey,"OrderByDesc",t)},expression:"newPrimaryKey.OrderByDesc"}})],1)],1),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.addPKDlgVisible=!1}}},[e._v("Cancel")]),n("el-button",{attrs:{type:"primary"},on:{click:e.addPrimaryKey}},[e._v("OK")])],1)],1),n("el-dialog",{attrs:{title:"Add Index",visible:e.addIndexDlgVisible,width:"500px"},on:{"update:visible":function(t){e.addIndexDlgVisible=t}}},[n("el-form",{attrs:{model:e.newIndex,"label-width":"100px",size:"small"}},[n("el-form-item",{attrs:{prop:"Name",label:"Name:"}},[n("el-input",{model:{value:e.newIndex.Name,callback:function(t){e.$set(e.newIndex,"Name",t)},expression:"newIndex.Name"}})],1),n("el-form-item",{attrs:{label:"Fields:"}},[n("el-select",{staticStyle:{width:"100%"},attrs:{"value-key":"MID",multiple:""},model:{value:e.newIndex.Fields,callback:function(t){e.$set(e.newIndex,"Fields",t)},expression:"newIndex.Fields"}},e._l(e.members,(function(e){return n("el-option",{key:e.ID,attrs:{label:e.Name,value:{Name:e.Name,MID:e.ID,OrderByDesc:!1}}})})),1)],1),n("el-form-item",{attrs:{label:"Orders:"}},e._l(e.newIndex.Fields,(function(t){return n("span",{key:t.MID},[e._v(e._s(t.Name)+": "),n("el-switch",{attrs:{"active-text":"DESC","inactive-text":"ASC"},model:{value:t.OrderByDesc,callback:function(n){e.$set(t,"OrderByDesc",n)},expression:"item.OrderByDesc"}}),n("br")],1)})),0),n("el-form-item",{attrs:{label:""}},[n("el-checkbox",{model:{value:e.newIndex.Unique,callback:function(t){e.$set(e.newIndex,"Unique",t)},expression:"newIndex.Unique"}},[e._v("Unique")])],1)],1),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.addIndexDlgVisible=!1}}},[e._v("Cancel")]),n("el-button",{attrs:{type:"primary"},on:{click:e.addIndex}},[e._v("OK")])],1)],1)],1)},U=[],L={props:{target:{type:Object,required:!0},members:{type:Array,required:!0},options:{type:Object,required:!0}},data:function(){return{addPKDlgVisible:!1,addIndexDlgVisible:!1,currentPrimaryKey:null,currentIndex:null,newPrimaryKey:{ID:0,OrderByDesc:!1},newIndex:{Name:"",Unique:!1,Fields:[]},oldPrimaryKeys:[]}},methods:{pkNameFormat:function(e,t,n){return this.members.find((function(e){return e.ID===n})).Name},indexFieldsFormat:function(e,t,n){for(var i=this,r="",o=function(e){var t=n[e];0!==e&&(r+="; "),r+=i.members.find((function(e){return e.UID===t.MemberUID})).Name+" ",r+=t.OrderByDesc?"DESC":"ASC"},l=0;l<n.length;l++)o(l);return r},disabledMember:function(e){return!!this.options.PrimaryKeys.find((function(t){return t.MemberId===e}))},onCurrentPKChanged:function(e,t){this.currentPrimaryKey=e},onCurrentIndexChanged:function(e,t){this.currentIndex=e},addPrimaryKey:function(){this.addPKDlgVisible=!1,this.options.PrimaryKeys.push({MemberId:this.newPrimaryKey.ID,OrderByDesc:this.newPrimaryKey.OrderByDesc}),this.onPrimaryKeysChanged()},removePrimaryKey:function(){var e=this;if(this.currentPrimaryKey){var t=this.options.PrimaryKeys.findIndex((function(t){return t.MemberId===e.currentPrimaryKey.MemberId}));this.options.PrimaryKeys.splice(t,1),this.onPrimaryKeysChanged()}else this.$message("Please select primary key first!")},onPrimaryKeysChanged:function(e){var t=[this.target.ID,"PrimaryKeys",JSON.stringify(this.options.PrimaryKeys)],n=this;$runtime.channel.invoke("sys.DesignService.ChangeEntity",t).then((function(e){n.oldPrimaryKeys=n.options.PrimaryKeys.slice(),n.members.forEach((function(e){n.options.PrimaryKeys.find((function(t){return t.MemberId===e.ID}))&&(e.AllowNull=!1)}))})).catch((function(e){n.options.PrimaryKeys=n.oldPrimaryKeys,n.$message.error("Change PrimaryKeys error: "+e)}))},addIndex:function(){if(this.addIndexDlgVisible=!1,this.newIndex.Name)if(0!==this.newIndex.Fields.length){var e=[this.target.ID,"AddIndex",JSON.stringify(this.newIndex)],t=this;$runtime.channel.invoke("sys.DesignService.ChangeEntity",e).then((function(e){t.options.Indexes.push(e)})).catch((function(e){t.$message.error("Add index error: "+e)}))}else this.$message.error("Index has no fields");else this.$message.error("Index has no name")},removeIndex:function(){if(this.currentIndex){var e=this;this.$msgbox.confirm("Are you sure to drop selected index？","Confirm",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then((function(){var t=[e.target.ID,"RemoveIndex",e.currentIndex.ID],n=e;$runtime.channel.invoke("sys.DesignService.ChangeEntity",t).then((function(e){var t=n.options.Indexes.findIndex((function(e){return e.ID===n.currentIndex.ID}));n.options.Indexes.splice(t,1)})).catch((function(e){n.$message.error("Drop index error:"+e)}))})).catch((function(){}))}else this.$message("Please select index first!")}},mounted:function(){this.oldPrimaryKeys=this.options.PrimaryKeys.slice(),this.members.length>0&&(this.newPrimaryKey.ID=this.members[0].ID)}},H=L,J=(n("9238"),Object(f["a"])(H,j,U,!1,null,"efcd3d1a",null)),G=J.exports,W=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"view"},[n("h3",[e._v("Primary Key:")]),n("el-form",{attrs:{"label-width":"200px",size:"small"}},[n("el-form-item",{attrs:{label:"Partition Keys:"}},[n("el-select",{attrs:{multiple:""},on:{change:e.onPartitionKeysChanged},model:{value:e.options.PartitionKeys,callback:function(t){e.$set(e.options,"PartitionKeys",t)},expression:"options.PartitionKeys"}},e._l(e.members,(function(t){return n("el-option",{key:t.Name,attrs:{label:t.Name,value:t.ID,disabled:e.disabledMember(e.options,t.ID)}})})),1)],1),n("el-form-item",{attrs:{label:"Clustering Columns:"}},[n("el-select",{attrs:{"value-key":"MemberId",multiple:""},on:{change:e.onClusteringColumnsChanged},model:{value:e.options.ClusteringColumns,callback:function(t){e.$set(e.options,"ClusteringColumns",t)},expression:"options.ClusteringColumns"}},e._l(e.members,(function(t){return n("el-option",{key:t.Name,attrs:{label:t.Name,value:{MemberId:t.ID,OrderByDesc:!1},disabled:e.disabledMember(e.options,t.ID)}})})),1)],1),n("el-form-item",{attrs:{label:"Clustering Orders:"}},e._l(e.options.ClusteringColumns,(function(t){return n("span",{key:t.MemberId},[e._v(e._s(e.getMemberName(t.MemberId))+": "),n("el-switch",{attrs:{"active-text":"DESC","inactive-text":"ASC"},on:{change:e.onClusteringColumnsChanged},model:{value:t.OrderByDesc,callback:function(n){e.$set(t,"OrderByDesc",n)},expression:"item.OrderByDesc"}})],1)})),0)],1),n("h3",[e._v("Secondary Index:")]),n("el-form",{attrs:{"label-width":"200px",size:"small"}},[n("el-form-item",{attrs:{label:"Native Indexs:"}},[n("el-select",{attrs:{multiple:""},model:{value:e.options.ContainsIndexs,callback:function(t){e.$set(e.options,"ContainsIndexs",t)},expression:"options.ContainsIndexs"}},e._l(e.members,(function(e){return n("el-option",{key:e.Name,attrs:{label:e.Name,value:e.Name}})})),1)],1),n("el-form-item",{attrs:{label:"Contains Indexs:"}},[n("el-select",{attrs:{multiple:""},model:{value:e.options.ContainsIndexs,callback:function(t){e.$set(e.options,"ContainsIndexs",t)},expression:"options.ContainsIndexs"}},e._l(e.members,(function(e){return n("el-option",{key:e.Name,attrs:{label:e.Name,value:e.Name}})})),1)],1),n("el-form-item",{attrs:{label:"Prefix Indexs:"}},[n("el-select",{attrs:{multiple:""},model:{value:e.options.ContainsIndexs,callback:function(t){e.$set(e.options,"ContainsIndexs",t)},expression:"options.ContainsIndexs"}},e._l(e.members,(function(e){return n("el-option",{key:e.Name,attrs:{label:e.Name,value:e.Name}})})),1)],1)],1),n("h3",[e._v("Materialized View:")]),n("el-tabs",{attrs:{type:"border-card",editable:""},on:{edit:e.onMVTabsEdit},model:{value:e.curMV,callback:function(t){e.curMV=t},expression:"curMV"}},e._l(e.options.MaterializedViews,(function(t,i){return n("el-tab-pane",{key:t.Name,attrs:{label:t.Name,name:t.Name}},[n("el-form",{attrs:{"label-width":"200px",size:"small"}},[n("el-form-item",{attrs:{label:"Partition Keys:"}},[n("el-select",{attrs:{multiple:""},on:{change:function(n){return e.onMVPartitionKeysChanged(t)}},model:{value:t.PartitionKeys,callback:function(n){e.$set(t,"PartitionKeys",n)},expression:"mv.PartitionKeys"}},e._l(e.members,(function(i){return n("el-option",{key:i.Name,attrs:{label:i.Name,value:i.ID,disabled:e.disabledMember(t,i.ID)}})})),1)],1),n("el-form-item",{attrs:{label:"Clustering Columns:"}},[n("el-select",{attrs:{"value-key":"Name",multiple:""},on:{change:function(n){return e.onMVClusteringColumnsChanged(t)}},model:{value:t.ClusteringColumns,callback:function(n){e.$set(t,"ClusteringColumns",n)},expression:"mv.ClusteringColumns"}},e._l(e.members,(function(i){return n("el-option",{key:i.Name,attrs:{label:i.Name,value:{MemberId:i.ID,OrderByDesc:!1},disabled:e.disabledMember(t,i.ID)}})})),1)],1),n("el-form-item",{attrs:{label:"Clustering Orders:"}},e._l(t.ClusteringColumns,(function(i){return n("span",{key:i.MemberId},[e._v(e._s(i.Name)+": "),n("el-switch",{attrs:{"active-text":"DESC","inactive-text":"ASC"},on:{change:function(n){return e.onMVClusteringColumnsChanged(t)}},model:{value:i.OrderDESC,callback:function(t){e.$set(i,"OrderDESC",t)},expression:"item.OrderDESC"}})],1)})),0)],1)],1)})),1),n("h3",[e._v("Others:")]),n("el-form",{attrs:{"label-width":"200px",size:"small"}},[n("el-form-item",{attrs:{label:"Default TTL(毫秒):"}},[n("el-input-number",{attrs:{"controls-position":"right",min:0},model:{value:e.options.DefaultTTL,callback:function(t){e.$set(e.options,"DefaultTTL",t)},expression:"options.DefaultTTL"}})],1)],1)],1)},Y=[],Z={props:{target:{type:Object,required:!0},members:{type:Array,required:!0},options:{type:Object,required:!0}},data:function(){return{curMV:""}},methods:{getMemberName:function(e){return this.members.find((function(t){return t.ID===e})).Name},disabledMember:function(e,t){return!!e.PartitionKeys.find((function(e){return e===t}))||!!e.ClusteringColumns.find((function(e){return e.MemberId===t}))},onMVTabsEdit:function(e,t){var n=this,i=this;if("add"===t){var r="";this.$prompt("MV Name:","Create Materialized View",{confirmButtonText:"Ok",cancelButtonText:"Cancel",inputPattern:/[a-zA-Z_0-9]+/,inputErrorMessage:"Name error"}).then((function(e){r=e.value;var t=[i.target.ID,"AddMV",r];return i.$channel.invoke("sys.DesignHub.ChangeTableOptions",t)})).then((function(e){i.options.MaterializedViews.push({Name:r,PartitionKeys:[],ClusteringColumns:[]}),i.curMV=r})).catch((function(e){i.$message.error("Create MV error: "+e)}))}else"remove"===t&&this.$confirm("Confirm to drop MV","Delete MV",{confirmButtonText:"Ok",cancelButtonText:"Cancel",type:"warning"}).then((function(t){var r=[n.target.ID,"RemoveMV",e];return i.$channel.invoke("sys.DesignHub.ChangeTableOptions",r)})).then((function(t){i.options.MaterializedViews=i.options.MaterializedViews.filter((function(t){return t.Name!==e})),i.curMV=i.options.MaterializedViews.length>0?i.options.MaterializedViews[0].Name:""})).catch((function(e){i.$message.error("Drop MV error: "+e)}))},onPartitionKeysChanged:function(e){var t=this,n=[this.target.ID,"PartitionKeys",JSON.stringify(this.options.PartitionKeys)],i=this;$runtime.channel.invoke("sys.DesignService.ChangeEntity",n).then((function(e){t.onPrimaryKeyChanged()})).catch((function(e){i.$message.error("Change PK PartitionKeys error: "+e)}))},onClusteringColumnsChanged:function(e){var t=this,n=[this.target.ID,"ClusteringColumns",JSON.stringify(this.options.ClusteringColumns)],i=this;$runtime.channel.invoke("sys.DesignService.ChangeEntity",n).then((function(e){t.onPrimaryKeyChanged()})).catch((function(e){i.$message.error("Change PK ClusteringColumns error: "+e)}))},onPrimaryKeyChanged:function(){var e=this;this.members.forEach((function(t){e.options.PartitionKeys.find((function(e){return e===t.ID}))||e.options.ClusteringColumns.find((function(e){return e.MemberId===t.ID}))?t.AllowNull=!1:t.AllowNull=!0}))},onMVPartitionKeysChanged:function(e){var t=[this.target.ID,"MVPartitionKeys",e.PartitionKeys,e.Name],n=this;$runtime.channel.invoke("sys.DesignService.ChangeEntity",t).catch((function(e){n.$message.error("Change MV PartitionKeys error: "+e)}))},onMVClusteringColumnsChanged:function(e){var t=[this.target.ID,"MVClusteringColumns",JSON.stringify(e.ClusteringColumns),e.Name],n=this;$runtime.channel.invoke("sys.DesignService.ChangeEntity",t).catch((function(e){n.$message.error("Change MV ClusteringColumns error: "+e)}))}},mounted:function(){this.options.MaterializedViews.length>0&&(this.curMV=this.options.MaterializedViews[0].Name)}},Q=Z,X=(n("3bdf"),Object(f["a"])(Q,W,Y,!1,null,"bf7cbe6e",null)),ee=X.exports,te=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-table",{attrs:{data:e.rows,"highlight-current-row":"",border:"",height:"100%","empty-text":" "}},e._l(e.columns,(function(t){return n("el-table-column",{key:t,attrs:{prop:t,label:t,formatter:e.formatCell}})})),1)},ne=[],ie={props:{target:{type:Object,required:!0},members:{type:Array,required:!0}},data:function(){return{rows:[],columns:[]}},methods:{loadData:function(){var e=this;$runtime.channel.invoke("sys.DesignService.LoadEntityData",[this.target.ID]).then((function(t){for(var n in t[0])t[0].hasOwnProperty(n)&&"$T"!==n&&e.columns.push(n);e.rows=t})).catch((function(t){e.$message.error(t)}))},formatCell:function(e,t,n,i){return"boolean"===typeof n?String(n):n}},mounted:function(){this.loadData()}},re=ie,oe=Object(f["a"])(re,te,ne,!1,null,null,null),le=oe.exports,se=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{staticClass:"dialog",attrs:{title:"Rename",visible:e.visible,"before-close":e.onClosing,width:"450px"},on:{"update:visible":function(t){e.visible=t},close:e.onClose}},[n("div",[n("el-alert",{attrs:{title:e.warningInfo,type:"warning","show-icon":"",closable:!1}}),n("br"),n("el-form",{attrs:{"label-width":"100px"}},[n("el-form-item",{attrs:{label:"Target"}},[n("el-input",{attrs:{readonly:"",size:"small"},model:{value:e.dlgProps.target,callback:function(t){e.$set(e.dlgProps,"target",t)},expression:"dlgProps.target"}})],1),n("el-form-item",{attrs:{label:"Old Name"}},[n("el-input",{attrs:{readonly:"",size:"small"},model:{value:e.dlgProps.oldName,callback:function(t){e.$set(e.dlgProps,"oldName",t)},expression:"dlgProps.oldName"}})],1),n("el-form-item",{attrs:{label:"New Name"}},[n("el-input",{attrs:{autofocus:"",size:"small"},model:{value:e.newName,callback:function(t){e.newName=t},expression:"newName"}})],1)],1)],1),n("div",{attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{disabled:e.caDisabled},on:{click:function(t){e.visible=!1}}},[e._v("Cancel")]),n("el-button",{attrs:{disabled:e.okDisabled,type:"primary"},on:{click:e.onOkClick}},[e._v("Ok")])],1)])},ae=[],ue={props:["dlgProps"],data:function(){return{visible:!0,newName:"",caDisabled:!1,running:!1,warningInfo:"请尽可能在刷新或签出所有节点后再进行此项操作，否则可能无法重命名其他开发者刚签入的模型引用。"}},computed:{okDisabled:function(){return!(this.newName&&!this.running&&this.newName!==this.dlgProps.oldName)}},methods:{onClosing:function(e){this.running||e()},onClose:function(){this.$emit("close")},onOkClick:function(){this.running=!0,this.caDisabled=!0;var e=this,t=[this.dlgProps.targetType,this.dlgProps.targetModel,this.dlgProps.oldName,this.newName];$runtime.channel.invoke("sys.DesignService.Rename",t).then((function(t){e.running=!1,e.caDisabled=!1,e.$message.success("Rename succeed"),e.visible=!1,t.push(e.dlgProps.targetModel),s["a"].designers.refreshDesigners(t)})).catch((function(t){e.running=!1,e.caDisabled=!1,e.$message.error("Rename error: "+t)}))}}},ce=ue,me=Object(f["a"])(ce,se,ae,!1,null,null,null),de=me.exports,pe=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{attrs:{title:"New Entity Member",width:"500px",visible:e.visible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.visible=t},close:e.onClose}},[n("el-form",{ref:"viewModel",attrs:{model:e.viewModel,rules:e.rules,"label-width":"120px","label-position":"right"}},[n("el-form-item",{attrs:{prop:"Name",required:!0,label:"Name:"}},[n("el-input",{model:{value:e.viewModel.Name,callback:function(t){e.$set(e.viewModel,"Name",t)},expression:"viewModel.Name"}})],1),n("el-form-item",{attrs:{prop:"EntityMemberType",label:"MemberType:"}},[n("el-select",{staticStyle:{width:"100%"},model:{value:e.viewModel.EntityMemberType,callback:function(t){e.$set(e.viewModel,"EntityMemberType",t)},expression:"viewModel.EntityMemberType"}},e._l(e.memberTypes,(function(e){return n("el-option",{key:e.value,attrs:{label:e.text,value:e.value}})})),1)],1),0===e.viewModel.EntityMemberType?[n("el-form-item",{attrs:{prop:"EntityFieldType",label:"FieldType:"}},[n("el-select",{key:"s-fieldtype",staticStyle:{width:"100%"},model:{value:e.viewModel.EntityFieldType,callback:function(t){e.$set(e.viewModel,"EntityFieldType",t)},expression:"viewModel.EntityFieldType"}},e._l(e.fieldTypes,(function(e){return n("el-option",{key:e.value,attrs:{label:e.text,value:e.value}})})),1)],1)]:e._e(),2===e.viewModel.EntityMemberType?[n("el-form-item",{attrs:{prop:"RefIds",label:"Ref Target:"}},[n("el-select",{key:"s-refids",staticStyle:{width:"100%"},attrs:{multiple:"",filterable:""},model:{value:e.viewModel.RefIds,callback:function(t){e.$set(e.viewModel,"RefIds",t)},expression:"viewModel.RefIds"}},e._l(e.RefTreeData,(function(t){return n("el-option-group",{key:t.ID,attrs:{label:t.Text,value:t.ID}},e._l(t.Nodes,(function(e){return n("el-option",{key:e.ID,attrs:{label:e.Name,value:e.ID}})})),1)})),1)],1)]:e._e(),3===e.viewModel.EntityMemberType?[n("el-form-item",{attrs:{prop:"SetId",required:!0,label:"Ref Target:"}},[n("el-select",{key:"s-setid",attrs:{filterable:""},model:{value:e.viewModel.SetId,callback:function(t){e.$set(e.viewModel,"SetId",t)},expression:"viewModel.SetId"}},e._l(e.SetTreeData,(function(e){return n("el-option",{key:e.Path,attrs:{label:e.Path,value:e}})})),1)],1)]:e._e(),3!==e.viewModel.EntityMemberType?n("el-form-item",{attrs:{prop:"AllowNull",label:"AllowNull:"}},[n("el-switch",{model:{value:e.viewModel.AllowNull,callback:function(t){e.$set(e.viewModel,"AllowNull",t)},expression:"viewModel.AllowNull"}})],1):e._e(),e.viewModel.AllowNull?e._e():n("el-form-item",{attrs:{prop:"DefaultValue",label:"DefaultValue:"}},[n("el-input",{model:{value:e.viewModel.DefaultValue,callback:function(t){e.$set(e.viewModel,"DefaultValue",t)},expression:"viewModel.DefaultValue"}})],1)],2),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{disabled:e.caDisabled},on:{click:function(t){e.visible=!1}}},[e._v("Cancel")]),n("el-button",{attrs:{disabled:e.okDisabled,type:"primary"},on:{click:function(t){return e.submit("viewModel")}}},[e._v("OK")])],1)],1)},he=[],fe={data:function(){this.$createElement;return{visible:!0,caDisabled:!1,okDisabled:!1,designer:null,RefTreeData:[],SetTreeData:[],viewModel:{Name:"",EntityMemberType:0,EntityFieldType:1,IsReverse:!1,RefIds:[],SetId:null,AllowNull:!0,DefaultValue:""},rules:{Name:[{validator:this.validateName,trigger:"change"}]},onRenderContent:function(e,t){var n;return 20===t.data.Type&&(n=e("el-checkbox",{attrs:{checked:"{node.node.checked}"}})),e("span",{class:"el-tree-node__label"},[n," ",t.data.Text])}}},computed:{treeOption:function(){return{label:"Text",children:"Nodes"}},memberTypes:function(){return this.designer?this.designer.memberTypes:[]},fieldTypes:function(){return c}},methods:{onClose:function(e){this.$emit("close")},submit:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return!1;t.okDisabled=!0,t.caDisabled=!0;var n=[t.designer.target.ID,t.viewModel.Name,t.viewModel.EntityMemberType];if(0===t.viewModel.EntityMemberType)n.push(t.viewModel.EntityFieldType),n.push(t.viewModel.AllowNull),t.viewModel.AllowNull||n.push(t.viewModel.DefaultValue);else if(2===t.viewModel.EntityMemberType){n.push(t.viewModel.AllowNull);var i=t.viewModel.RefIds.join(",");n.push(i),n.push(t.viewModel.IsReverse)}else 3===t.viewModel.EntityMemberType&&(n.push(t.viewModel.SetId.EntityID),n.push(t.viewModel.SetId.MemberID));var r=t;$runtime.channel.invoke("sys.DesignService.NewEntityMember",n).then((function(e){r.designer.addMember(e),r.$message.success("Add member succeed"),r.visible=!1,r.caDisabled=!1})).catch((function(e){r.okDisabled=!1,r.caDisabled=!1,r.$message.error(e)}))}))},validateName:function(e,t,n){if(!t)return n(new Error("Name can not be empty"));n()}},mounted:function(){var e=this;if(this.designer=s["a"].designers.getActiveDesigner(),!this.designer.isDTO){s["a"].tree.getAllEntityNodes(this.RefTreeData,this.designer.target.StoreId);var t=this.designer.target.ID;$runtime.channel.invoke("sys.DesignService.GetEntityRefModels",[t]).then((function(t){e.SetTreeData=t})).catch((function(t){e.$message.error(t)}))}}},be=fe,ye=Object(f["a"])(be,pe,he,!1,null,null,null),ge=ye.exports,ve=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{attrs:{title:"表达式编辑器",visible:e.visible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.visible=t},close:e.onClose}},[n("expression-editor",{ref:"editor",attrs:{ownerType:e.ownerType,ownerID:e.ownerID,propertyName:e.propertyName}}),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{disabled:e.caDisabled},on:{click:function(t){e.visible=!1}}},[e._v("取 消")]),n("el-button",{attrs:{disabled:e.okDisabled,type:"primary"},on:{click:e.onOkClick}},[e._v("确 定")])],1)],1)},De=[],we=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("code-editor",{ref:"editor",attrs:{height:e.height,language:"csharp",fileName:e.fileName},on:{mounted:e.onEditorMounted}})},Ie=[],xe=n("0ea0"),Me={components:{CodeEditor:xe["a"]},props:{ownerType:{type:String,default:""},ownerID:{type:String,default:""},propertyName:{type:String,default:""}},data:function(){return{height:500}},computed:{fileName:function(){return this.ownerType+"_"+this.ownerID+"_"+this.propertyName+".cs"}},methods:{onEditorMounted:function(){var e=this;$runtime.channel.invoke("sys.DesignService.OpenExpression",[this.ownerType,this.ownerID,this.propertyName]).then((function(t){e.onCodeLoaded(t)})).catch((function(t){e.$message.error("加载表达式错误: "+t)}))},onCodeLoaded:function(e){this.$refs.editor.initValue(e.Source),this.$refs.editor.$on("codeChanged",this.onCodeChanged),this.$refs.editor.focus()},onCodeChanged:function(e){for(var t=this,n=0;n<e.changes.length;n++){var i=e.changes[n];$runtime.channel.invoke("sys.DesignService.ChangeBuffer",[2,this.fileName,i.range.startLineNumber,i.range.startColumn,i.range.endLineNumber,i.range.endColumn,i.text]).catch((function(e){t.$message.warning("提交代码变更错误: "+e)}))}},close:function(e){var t=this;$runtime.channel.invoke("sys.DesignService.CloseExpression",[this.fileName,e]).catch((function(e){t.$message.error("关闭表达式编辑器错误: "+e)}))}}},Ce=Me,Ne=Object(f["a"])(Ce,we,Ie,!1,null,null,null),ke=Ne.exports,Pe={components:{ExpressionEditor:ke},props:{ownerType:{type:String,default:""},ownerID:{type:String,default:""},propertyName:{type:String,default:""}},data:function(){return{visible:!0,okDisabled:!1,caDisabled:!1,isCancel:!0}},methods:{onClose:function(){this.$refs.editor.close(this.isCancel),this.$emit("close")},onOkClick:function(){this.isCancel=!1,this.visible=!1}}},Ke=Pe,$e=Object(f["a"])(Ke,ve,De,!1,null,null,null),Se=$e.exports,Ee={components:{DataFieldDesigner:y,EntityRefDesigner:M,EntitySetDesigner:$,SysStoreOptions:z,SqlStoreOptions:G,CqlStoreOptions:ee,EntityDataView:le},props:{target:{type:Object,required:!0}},data:function(){return{activeView:"members",views:[{label:"members",title:"Members"}],designerType:"EntityDesigner",isNew:!1,members:[],collapseValue:["1"],currentMember:null,currentMemberDesigner:null,currentMemberTitle:null,expressionDialog:null,options:null}},computed:{storeTitle:function(){return this.options?this.options.StoreName?this.options.StoreKind===T["a"].Sql?"SqlStore - "+this.options.StoreName:"CqlStore - "+this.options.StoreName:this.options.PartitionKeys&&this.options.PartitionKeys.length>0?"Default - Partitioned":"Default - NonPartitioned":"DTO"},memberTypes:function(){return S(this.isDTO)}},methods:{onAddMember:function(){var e=l["default"].component("NewEntityMemberDialog",ge);s["a"].ide.showDialog(e)},onRemoveMember:function(){var e=this.target.ID,t=this.currentMember.Name,n=this;this.$msgbox.confirm("Are you sure to delete member: "+t,"Confirm",{confirmButtonText:"Yes",cancelButtonText:"No",type:"warning"}).then((function(){$runtime.channel.invoke("sys.DesignService.DeleteEntityMember",[e,t]).then((function(e){e&&e.length?(s["a"].usages.update(e),n.$message.error("Member has references, can not delete")):(n.removeCurrentMember(),n.$message.success("Delete member succeed"))})).catch((function(e){n.$message.error(e)}))})).catch((function(){}))},entityMemberTypeFormat:function(e,t){var n=this.memberTypes.find((function(t){return t.value===e.Type})),i=n?n.text:"Unknown";return e.DataType&&(i+=" - "+c.find((function(t){return t.value===e.DataType})).text),i},currentRowChange:function(e,t){if(this.currentMember=e,this.collapseValue=["1","2"],!e)return this.collapseValue=["1"],this.currentMemberDesigner=null,this.currentMemberTitle=null,!0;switch(e.Type){case 0:this.currentMemberDesigner=y,this.currentMemberTitle="DataField Properties";break;case 2:this.currentMemberDesigner=M,this.currentMemberTitle="EntityRef Properties";break;case 3:this.currentMemberDesigner=$,this.currentMemberTitle="EntitySet Properties";break;case 7:this.currentMemberDesigner=AutoNumberDesigner,this.currentMemberTitle="AutoNumber Properties";break;case 11:this.currentMemberDesigner=FieldSetDesigner,this.currentMemberTitle="FieldSet Properties";break;default:break}},addMember:function(e){this.members.push(e),this.selectMember(this.members[this.members.length-1]),this.currentMember=e},selectMember:function(e){this.currentMember=e,this.$refs.memberTable.setCurrentRow(e)},removeCurrentMember:function(){if(!this.currentMember)return!1;var e=this.members.indexOf(this.currentMember);this.members.splice(e,1)},onRenameMember:function(){var e=this.target.ID,t=this.currentMember.Name,n=l["default"].component("RenameDialog",de);s["a"].ide.showDialog(n,{target:this.target.Text+"."+t,targetModel:e,targetType:O.EntityMemberName,oldName:t})},onFindUsages:function(){var e=this.target.ID,t=this.currentMember.Name,n=this,i=[O.EntityMemberName,e,t];$runtime.channel.invoke("sys.DesignService.FindUsages",i).then((function(e){s["a"].usages.update(e)})).catch((function(e){n.$message.error(e)}))},onOpenExpressionEditor:function(){this.expressionDialog=l["default"].component("ExpressionEditorDialog",Se)},onCloseExpressionEditor:function(){this.expressionDialog=null},save:function(){var e=this,t=this;$runtime.channel.invoke("sys.DesignService.SaveModel",[this.target.Type,this.target.ID]).then((function(n){t.$message.success("保存成功"),_["a"].update(d["a"].Entity,e.target.ID)})).catch((function(e){t.$message.error("保存失败: "+e)}))},refresh:function(){var e=this;$runtime.channel.invoke("sys.DesignService.GetEntityModel",[this.target.ID]).then((function(t){e.isNew=t.IsNew,e.members=t.Members,t.StoreOptions&&1===e.views.length&&(t.StoreOptions.StoreKind===T["a"].Sql?e.views.push({label:"sqlopts",title:"Options"}):t.StoreOptions.StoreKind===T["a"].Cql?e.views.push({label:"cqlopts",title:"Options"}):e.views.push({label:"sysopts",title:"Options"}),e.views.push({label:"data",title:"Data"})),e.options=t.StoreOptions})).catch((function(t){e.$message.error(t)}))}},mounted:function(){this.refresh()}},Oe=Ee,_e=(n("f38e"),Object(f["a"])(Oe,r,o,!1,null,"fee12598",null));t["default"]=_e.exports},9238:function(e,t,n){"use strict";var i=n("1946"),r=n.n(i);r.a},"9c1b":function(e,t,n){},cdc6:function(e,t,n){"use strict";var i=n("14b0"),r=n.n(i);r.a},e2f5:function(e,t,n){},f38e:function(e,t,n){"use strict";var i=n("9c1b"),r=n.n(i);r.a}}]);