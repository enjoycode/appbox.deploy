var et=Object.defineProperty;var tt=(s,i,t)=>i in s?et(s,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[i]=t;var o=(s,i,t)=>(tt(s,typeof i!="symbol"?i+"":i,t),t),Ke=(s,i,t)=>{if(!i.has(s))throw TypeError("Cannot "+t)};var h=(s,i,t)=>(Ke(s,i,"read from private field"),t?t.call(s):i.get(s)),m=(s,i,t)=>{if(i.has(s))throw TypeError("Cannot add the same private member more than once");i instanceof WeakSet?i.add(s):i.set(s,t)},p=(s,i,t,n)=>(Ke(s,i,"write to private field"),n?n.call(s,t):i.set(s,t),t);import*as u from"/System.js";import{List as $e,initializeSystem as it}from"/System.js";import*as e from"/PixUI.js";import*as C from"/AppBoxClient.js";import{initializeAppBoxClient as nt,Channel as ot,WebChannel as rt}from"/AppBoxClient.js";import*as d from"/AppBoxCore.js";import{TypeSerializer as g,PayloadType as y,FieldWithOrder as lt}from"/AppBoxCore.js";import*as _e from"/CodeEditor.js";import{TSCSharpLanguage as st}from"/CodeEditor.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function t(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerpolicy&&(l.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?l.credentials="include":r.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(r){if(r.ep)return;r.ep=!0;const l=t(r);fetch(r.href,l)}})();const dt="modulepreload",at=function(s){return"/dev/"+s},Ue={},ut=function(i,t,n){if(!t||t.length===0)return i();const r=document.getElementsByTagName("link");return Promise.all(t.map(l=>{if(l=at(l),l in Ue)return;Ue[l]=!0;const c=l.endsWith(".css"),Ne=c?'[rel="stylesheet"]':"";if(!!n)for(let R=r.length-1;R>=0;R--){const me=r[R];if(me.href===l&&(!c||me.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${Ne}`))return;const F=document.createElement("link");if(F.rel=c?"stylesheet":dt,c||(F.as="script",F.crossOrigin=""),F.href=l,document.head.appendChild(F),c)return new Promise((R,me)=>{F.addEventListener("load",R),F.addEventListener("error",()=>me(new Error(`Unable to preload CSS for ${l}`)))})})).then(()=>i())};class ct extends e.View{constructor(t){super();o(this,"_controller");t.InvalidateAction=()=>this.Run(),this._controller=t}async Run(){let t=Date.now().toString();const n="/preview/view/"+C.Channel.SessionId+"/"+this._controller.ModelNode.Id+"?v="+t;try{let r=await ut(()=>import(n),[]),l=r[this._controller.ModelNode.Label.Value].Preview,c;l?c=l():c=new r[this._controller.ModelNode.Label.Value],this.Child=new e.Container().Init({Child:c}),this.Invalidate(e.InvalidAction.Relayout),this._controller.CurrentWidget=c,this._controller.RefreshOutlineAction?.call(this)}catch(r){console.warn("\u83B7\u53D6\u9884\u89C8\u5931\u8D25: ",r)}}OnMounted(){super.OnMounted(),this.Run()}}var I=(s=>(s[s.ApplicationRoot=0]="ApplicationRoot",s[s.DataStoreRootNode=1]="DataStoreRootNode",s[s.DataStoreNode=2]="DataStoreNode",s[s.ApplicationNode=3]="ApplicationNode",s[s.ModelRootNode=4]="ModelRootNode",s[s.FolderNode=5]="FolderNode",s[s.ModelNode=6]="ModelNode",s))(I||{});class ht{constructor(){o(this,"ModelType","");o(this,"ModelId","")}WriteTo(i){throw new u.NotSupportedException}ReadFrom(i){this.ModelType=i.ReadString(),this.ModelId=i.ReadString()}}class mt{constructor(){o(this,"StartLine",0);o(this,"StartColumn",0);o(this,"EndLine",0);o(this,"EndColumn",0);o(this,"IsError",!1);o(this,"Message","")}get Position(){return`[${this.StartLine+1}, ${this.StartColumn}] - [${this.EndLine+1}, ${this.EndColumn}]`}WriteTo(i){throw new u.NotSupportedException}ReadFrom(i){this.StartLine=i.ReadInt(),this.StartColumn=i.ReadInt(),this.EndLine=i.ReadInt(),this.EndColumn=i.ReadInt(),this.IsError=i.ReadBool(),this.Message=i.ReadString()}}var x,O,A,B;class pt{constructor(){m(this,x,0);m(this,O,void 0);m(this,A,!1);m(this,B,void 0)}get IndexId(){return h(this,x)}set IndexId(i){p(this,x,i)}get Name(){return h(this,O)}set Name(i){p(this,O,i)}get Unique(){return h(this,A)}set Unique(i){p(this,A,i)}get Fields(){return h(this,B)}set Fields(i){p(this,B,i)}WriteTo(i){throw new u.NotSupportedException}ReadFrom(i){this.IndexId=i.ReadByte(),this.Name=i.ReadString(),this.Unique=i.ReadBool(),this.Fields=new Array(i.ReadVariant()).fill(d.FieldWithOrder.Empty.Clone());for(let t=0;t<this.Fields.length;t++)this.Fields[t].ReadFrom(i)}}x=new WeakMap,O=new WeakMap,A=new WeakMap,B=new WeakMap;class It extends pt{}var v,L,V;class Ct{constructor(){m(this,v,0n);m(this,L,void 0);m(this,V,void 0)}get StoreModelId(){return h(this,v)}set StoreModelId(i){p(this,v,i)}get PrimaryKeys(){return h(this,L)}set PrimaryKeys(i){p(this,L,i)}get Indexes(){return h(this,V)}set Indexes(i){p(this,V,i)}ReadFrom(i){this.StoreModelId=i.ReadLong();let t=i.ReadVariant();this.PrimaryKeys=new u.List;for(let r=0;r<t;r++){let l=new d.FieldWithOrder;l.ReadFrom(i),this.PrimaryKeys.Add(l.Clone())}let n=i.ReadVariant();this.Indexes=new u.List;for(let r=0;r<n;r++){let l=new It;l.ReadFrom(i),this.Indexes.Add(l)}}}v=new WeakMap,L=new WeakMap,V=new WeakMap;var P;class De{constructor(){m(this,P,0);o(this,"Name");o(this,"AllowNull",!1);o(this,"Comment")}get Id(){return h(this,P)}set Id(i){p(this,P,i)}get IsForeignKeyMember(){return this.Type==d.EntityMemberType.EntityField&&this.IsForeignKey}toString(){return this.Name}WriteTo(i){throw new u.NotSupportedException}ReadFrom(i){this.Id=i.ReadShort(),this.Name=i.ReadString(),this.AllowNull=i.ReadBool(),this.Comment=i.ReadString()}}P=new WeakMap;var W,G;class He extends De{constructor(){super(...arguments);m(this,W,0);m(this,G,!1);o(this,"EnumModelId");o(this,"Length",0);o(this,"Decimals",0)}get Type(){return d.EntityMemberType.EntityField}get FieldType(){return h(this,W)}set FieldType(t){p(this,W,t)}get IsForeignKey(){return h(this,G)}set IsForeignKey(t){p(this,G,t)}ReadFrom(t){super.ReadFrom(t),this.FieldType=t.ReadByte(),this.IsForeignKey=t.ReadBool(),this.FieldType==d.EntityFieldType.Enum&&(this.EnumModelId=t.ReadLong()),this.Length=t.ReadVariant(),this.Decimals=t.ReadVariant()}}W=new WeakMap,G=new WeakMap;var k;class Ee extends De{constructor(){super(...arguments);o(this,"RefModelIds",new u.List);m(this,k,void 0);o(this,"IsReverse",!1);o(this,"IsAggregationRef",!1);o(this,"IsForeignKeyConstraint",!1)}get Type(){return d.EntityMemberType.EntityRef}get FKMemberIds(){return h(this,k)}set FKMemberIds(t){p(this,k,t)}ReadFrom(t){super.ReadFrom(t),this.IsReverse=t.ReadBool(),this.IsAggregationRef=t.ReadBool(),this.IsForeignKeyConstraint=t.ReadBool();let n=t.ReadVariant();for(let r=0;r<n;r++)this.RefModelIds.Add(t.ReadLong());n=t.ReadVariant(),this.FKMemberIds=new Int16Array(n);for(let r=0;r<n;r++)this.FKMemberIds[r]=t.ReadShort()}}k=new WeakMap;class qe extends De{constructor(){super(...arguments);o(this,"RefModelId",0n);o(this,"RefMemberId",0)}get Type(){return d.EntityMemberType.EntitySet}ReadFrom(t){super.ReadFrom(t),this.RefModelId=t.ReadLong(),this.RefMemberId=t.ReadShort()}}class wt{constructor(){o(this,"IsNew",!1);o(this,"Members",new u.List);o(this,"DataStoreKind",0);o(this,"_storeOptions")}get SqlStoreOptions(){return this._storeOptions}WriteTo(i){throw new u.NotSupportedException}ReadFrom(i){if(this.IsNew=i.ReadBool(),this.DataStoreKind=i.ReadByte(),this.DataStoreKind==d.DataStoreKind.Sql){let n=new Ct;n.ReadFrom(i),this._storeOptions=n}let t=i.ReadVariant();for(let n=0;n<t;n++){let r=i.ReadByte(),l;switch(r){case d.EntityMemberType.EntityField:l=new He;break;case d.EntityMemberType.EntityRef:l=new Ee;break;case d.EntityMemberType.EntitySet:l=new qe;break;default:throw new u.NotImplementedException}l.ReadFrom(i),this.Members.Add(l)}}}class _t{constructor(){o(this,"AppName");o(this,"ModelName");o(this,"MemberName");o(this,"ModelId");o(this,"MemberId",0)}toString(){return`${this.AppName}.${this.ModelName}.${this.MemberName}`}WriteTo(i){throw new u.NotSupportedException}ReadFrom(i){this.AppName=i.ReadString(),this.ModelName=i.ReadString(),this.MemberName=i.ReadString(),this.ModelId=i.ReadString(),this.MemberId=i.ReadShort()}}var K,$,U,z,H,q;class gt{constructor(){m(this,K,void 0);m(this,$,void 0);m(this,U,void 0);m(this,z,-1);m(this,H,-1);m(this,q,-1)}get ModelId(){return h(this,K)}set ModelId(i){p(this,K,i)}get ModelName(){return h(this,$)}set ModelName(i){p(this,$,i)}get Location(){return h(this,U)}set Location(i){p(this,U,i)}get Offset(){return h(this,z)}set Offset(i){p(this,z,i)}get Length(){return h(this,H)}set Length(i){p(this,H,i)}get TargetType(){return h(this,q)}set TargetType(i){p(this,q,i)}WriteTo(i){throw new u.NotSupportedException}ReadFrom(i){this.ModelId=i.ReadString(),this.ModelName=i.ReadString(),this.Location=i.ReadString(),this.Offset=i.ReadVariant(),this.Length=i.ReadVariant(),this.TargetType=i.ReadVariant()}}K=new WeakMap,$=new WeakMap,U=new WeakMap,z=new WeakMap,H=new WeakMap,q=new WeakMap;var j,J,Q;class yt{constructor(){m(this,j,0);m(this,J,0);m(this,Q,void 0)}get Offset(){return h(this,j)}set Offset(i){p(this,j,i)}get Length(){return h(this,J)}set Length(i){p(this,J,i)}get Text(){return h(this,Q)}set Text(i){p(this,Q,i)}WriteTo(i){throw new u.NotSupportedException}ReadFrom(i){this.Offset=i.ReadInt(),this.Length=i.ReadInt(),this.Text=i.ReadString()}}j=new WeakMap,J=new WeakMap,Q=new WeakMap;class St{static GetIconForModelType(i){switch(i){case d.ModelType.Entity:return e.Icons.Filled.TableChart;case d.ModelType.Service:return e.Icons.Filled.Settings;case d.ModelType.View:return e.Icons.Filled.Wysiwyg;case d.ModelType.Report:return e.Icons.Filled.PieChart;case d.ModelType.Enum:return e.Icons.Filled.ViewList;case d.ModelType.Permission:return e.Icons.Filled.Lock;default:return e.Icons.Filled.TableChart}}}function je(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)&&"$meta_AppBoxDesign_IModelDesigner"in s.constructor}var X;class f{constructor(){m(this,X,void 0);o(this,"Label",e.State.op_Implicit_From("None"));o(this,"Designer")}get Children(){return null}get Id(){return h(this,X)}set Id(i){p(this,X,i)}toString(){return this.Label.Value}ReadFrom(i){this.Id=i.ReadString(),this.Label.Value=i.ReadString()}}X=new WeakMap;class Ft extends f{constructor(){super(...arguments);o(this,"_children",new u.List)}get Type(){return I.DataStoreRootNode}get Children(){return this._children}ReadFrom(t){super.ReadFrom(t);let n=t.ReadVariant();for(let r=0;r<n;r++){let l=new N;l.ReadFrom(t),this._children.Add(l)}}}const Ve=class extends f{get Type(){return I.DataStoreNode}};let N=Ve;o(N,"None",new Ve);class ft extends f{constructor(){super(...arguments);o(this,"_children",new u.List)}get Type(){return I.ApplicationRoot}get Children(){return this._children}ReadFrom(t){super.ReadFrom(t);let n=t.ReadVariant();for(let r=0;r<n;r++){let l=new Tt;l.ReadFrom(t),this._children.Add(l)}}}class Tt extends f{constructor(){super(...arguments);o(this,"_children",new u.List)}get Type(){return I.ApplicationNode}get Children(){return this._children}ReadFrom(t){super.ReadFrom(t);let n=t.ReadVariant();for(let r=0;r<n;r++){let l=new Mt(this);l.ReadFrom(t),this._children.Add(l)}}}class Mt extends f{constructor(t){super();o(this,"ApplicationNode");o(this,"_children",new u.List);this.ApplicationNode=t}get Type(){return I.ModelRootNode}get Children(){return this._children}ReadFrom(t){super.ReadFrom(t);let n=t.ReadVariant();for(let r=0;r<n;r++){let l=t.ReadByte(),c;if(l==I.ModelNode)c=new he(this);else if(l==I.FolderNode)c=new Te(this);else throw new u.NotSupportedException;c.ReadFrom(t),this._children.Add(c)}}}class Te extends f{constructor(t){super();o(this,"ModelRootNode");o(this,"_children",new u.List);this.ModelRootNode=t}get Type(){return I.FolderNode}get Children(){return this._children}ReadFrom(t){super.ReadFrom(t);let n=t.ReadVariant();for(let r=0;r<n;r++){let l=t.ReadByte(),c;if(l==I.ModelNode)c=new he(this.ModelRootNode);else if(l==I.FolderNode)c=new Te(this.ModelRootNode);else throw new u.NotSupportedException;c.ReadFrom(t),this._children.Add(c)}}}var Y;class he extends f{constructor(t){super();o(this,"ModelRootNode");m(this,Y,0);this.ModelRootNode=t}get AppName(){return this.ModelRootNode.ApplicationNode.Label.Value}get Type(){return I.ModelNode}get ModelType(){return h(this,Y)}set ModelType(t){p(this,Y,t)}ReadFrom(t){super.ReadFrom(t),this.ModelType=t.ReadByte()}}Y=new WeakMap;class Nt{constructor(){o(this,"RootNodes",new u.List)}WriteTo(i){throw new u.NotSupportedException}ReadFrom(i){let t=i.ReadVariant();for(let n=0;n<t;n++){let r=i.ReadByte(),l;if(r==I.DataStoreRootNode)l=new Ft;else if(r==I.ApplicationRoot)l=new ft;else throw new u.NotSupportedException;l.ReadFrom(i),this.RootNodes.Add(l)}}}var Z,ee,te,ie;class Rt{constructor(){m(this,Z,0);m(this,ee,"");m(this,te,void 0);m(this,ie,void 0)}get Kind(){return h(this,Z)}set Kind(i){p(this,Z,i)}get Label(){return h(this,ee)}set Label(i){p(this,ee,i)}get InsertText(){return h(this,te)}set InsertText(i){p(this,te,i)}get Detail(){return h(this,ie)}set Detail(i){p(this,ie,i)}WriteTo(i){throw new u.NotSupportedException}ReadFrom(i){this.Kind=i.ReadByte(),this.Label=i.ReadString(),this.InsertText=i.ReadString(),this.Detail=i.ReadString()}}Z=new WeakMap,ee=new WeakMap,te=new WeakMap,ie=new WeakMap;var ne,oe,re,le,se,de;const ye=class{constructor(){m(this,ne,0);m(this,oe,void 0);m(this,re,void 0);m(this,le,void 0);m(this,se,0);m(this,de,void 0)}get ParentNodeType(){return h(this,ne)}set ParentNodeType(i){p(this,ne,i)}get ParentNodeId(){return h(this,oe)}set ParentNodeId(i){p(this,oe,i)}get NewNode(){return h(this,re)}set NewNode(i){p(this,re,i)}get RootNodeId(){return h(this,le)}set RootNodeId(i){p(this,le,i)}get InsertIndex(){return h(this,se)}set InsertIndex(i){p(this,se,i)}get ParentNode(){return h(this,de)}set ParentNode(i){p(this,de,i)}WriteTo(i){throw new u.NotSupportedException}ReadFrom(i){switch(this.ParentNodeType=i.ReadByte(),this.ParentNodeId=i.ReadString(),this.RootNodeId=i.ReadString(),this.InsertIndex=i.ReadInt(),this.ParentNode=a.TreeController.FindNode(n=>n.Type==this.ParentNodeType&&n.Id==this.ParentNodeId),i.ReadByte()){case I.FolderNode:this.NewNode=new Te(ye.GetModelRootNode(this.ParentNode));break;case I.ModelNode:this.NewNode=new he(ye.GetModelRootNode(this.ParentNode));break;case I.DataStoreNode:this.NewNode=new N;break;default:throw new u.NotSupportedException}this.NewNode.ReadFrom(i)}static GetModelRootNode(i){switch(i.Data.Type){case I.ModelRootNode:return i.Data;case I.FolderNode:return i.Data.ModelRootNode;default:throw new u.NotSupportedException}}};let Re=ye;ne=new WeakMap,oe=new WeakMap,re=new WeakMap,le=new WeakMap,se=new WeakMap,de=new WeakMap;const Pe=class{get TriggerCharacters(){return[46]}async ProvideCompletionItems(i,t,n){let r=await C.Channel.Invoke("sys.DesignService.GetCompletion",[0,i.Tag,t,n]);return r??null}};let E=Pe;o(E,"Default",new Pe);class ze extends e.Dialog{constructor(t){super();o(this,"_name",e.State.op_Implicit_From(""));o(this,"_type");this.Width=e.State.op_Implicit_From(300),this.Height=e.State.op_Implicit_From(180),this.Title.Value=`New ${t}`,this._type=t}BuildBody(){return new e.Container().Init({Padding:e.State.op_Implicit_From(e.EdgeInsets.All(20)),Child:new e.Input(this._name).Init({HintText:"Please input name"})})}OnClosing(t){return!t&&!u.IsNullOrEmpty(this._name.Value)&&this.CreateAsync(),super.OnClosing(t)}async CreateAsync(){let t=a.TreeController.FirstSelectedNode;if(t==null)return;let n=`sys.DesignService.New${this._type}`;this._type!="Application"&&this._type!="Folder"&&(n+="Model");let r=this._type=="Application"?[this._name.Value]:[Math.floor(t.Data.Type)&4294967295,t.Data.Id,this._name.Value],l=await C.Channel.Invoke(n,r);a.OnNewNode(l)}}class be extends e.Dialog{constructor(){super();o(this,"_name",e.State.op_Implicit_From(""));o(this,"_store",new e.Rx(null));this.Width=e.State.op_Implicit_From(300),this.Height=e.State.op_Implicit_From(210),this.Title.Value="New Entity"}BuildBody(){return new e.Container().Init({Padding:e.State.op_Implicit_From(e.EdgeInsets.All(20)),Child:new e.Column().Init({Children:[new e.Form().Init({LabelWidth:80,Children:[new e.FormItem("Name:",new e.Input(this._name)),new e.FormItem("DataStore:",new e.Select(this._store).Init({Options:be.GetAllDataStores()}))]})]})})}OnClosing(t){return!t&&!u.IsNullOrEmpty(this._name.Value)&&this.CreateAsync(),super.OnClosing(t)}async CreateAsync(){let t=a.TreeController.FirstSelectedNode;if(t==null)return;let n=[Math.floor(t.Data.Type)&4294967295,t.Data.Id,this._name.Value,this._store.Value==null?null:this._store.Value.Id],r=await C.Channel.Invoke("sys.DesignService.NewEntityModel",n);a.OnNewNode(r)}static GetAllDataStores(){let t=a.TreeController.DataSource[0],n=new Array(t.Children.length+1);n[0]=N.None;for(let r=1;r<n.length;r++)n[r]=t.Children[r-1];return n}}class xe extends e.Dialog{constructor(){super();o(this,"_dataGridController",new e.DataGridController);this.Width=e.State.op_Implicit_From(400),this.Height=e.State.op_Implicit_From(300),this.Title.Value="Publish"}BuildBody(){return new e.Container().Init({Padding:e.State.op_Implicit_From(e.EdgeInsets.All(20)),Child:new e.DataGrid(this._dataGridController).Init({Columns:[new e.DataGridTextColumn("ModelType",t=>t.ModelType),new e.DataGridTextColumn("ModelId",t=>t.ModelId)]})})}OnMounted(){super.OnMounted(),this.LoadChanges()}async LoadChanges(){try{let t=await C.Channel.Invoke("sys.DesignService.GetPendingChanges");t!=null&&(this._dataGridController.DataSource=new u.List(t))}catch(t){e.Notification.Error(`\u52A0\u8F7D\u6A21\u578B\u53D8\u66F4\u5931\u8D25:${t.Message}`)}}OnClosing(t){return t||xe.PublishAsync(),super.OnClosing(t)}static async PublishAsync(){try{await C.Channel.Invoke("sys.DesignService.Publish",["commit message"]),e.Notification.Success("\u53D1\u5E03\u6210\u529F")}catch(t){e.Notification.Error(`\u53D1\u5E03\u5931\u8D25: ${t.Message}`)}}}class Je extends e.Dialog{constructor(t,n,r,l){super();o(this,"_referenceType");o(this,"_modelId");o(this,"_target");o(this,"_oldName");o(this,"_newName",e.State.op_Implicit_From(""));this._referenceType=t,this._target=e.State.op_Implicit_From(n),this._modelId=r,this._oldName=e.State.op_Implicit_From(l),this.Title.Value=this.GetTitile(),this.Width=e.State.op_Implicit_From(380),this.Height=e.State.op_Implicit_From(240)}GetTitile(){switch(this._referenceType){case d.ModelReferenceType.EntityModel:return"Rename Entity";case d.ModelReferenceType.EntityMember:return"Rename Entity Member";case d.ModelReferenceType.ServiceModel:return"Rename Service";case d.ModelReferenceType.ViewModel:return"Rename View";default:return"Rename"}}GetNewName(){return this._newName.Value}BuildBody(){return new e.Container().Init({Padding:e.State.op_Implicit_From(e.EdgeInsets.All(20)),Child:new e.Form().Init({LabelWidth:100,Children:[new e.FormItem("Target:",new e.Input(this._target).Init({Readonly:e.State.op_Implicit_From(!0)})),new e.FormItem("Old Name:",new e.Input(this._oldName).Init({Readonly:e.State.op_Implicit_From(!0)})),new e.FormItem("New Name:",new e.Input(this._newName))]})})}OnClosing(t){return t||this.RenameAsync(),super.OnClosing(t)}async RenameAsync(){try{let t=await C.Channel.Invoke("sys.DesignService.Rename",[Math.floor(this._referenceType)&4294967295,this._modelId,this._oldName.Value,this._newName.Value]);a.OnRenameDone(this._referenceType,this._modelId,t),e.Notification.Success("\u91CD\u547D\u540D\u6210\u529F")}catch(t){e.Notification.Error(`\u91CD\u547D\u540D\u5931\u8D25: ${t.Message}`)}}}const T=class{static async Checkout(){let i=a.TreeController.FirstSelectedNode;if(i==null){e.Notification.Error("\u8BF7\u5148\u9009\u62E9\u5F85\u7B7E\u51FA\u8282\u70B9");return}let t=i.Data.Type;if(t!=I.ModelNode&&t!=I.ModelRootNode&&t!=I.DataStoreNode){e.Notification.Error("\u65E0\u6CD5\u7B7E\u51FA\u8BE5\u7C7B\u578B\u8282\u70B9");return}try{await C.Channel.Invoke("sys.DesignService.CheckoutNode",[Math.floor(t)&4294967295,i.Data.Id]),e.Notification.Success(`\u7B7E\u51FA\u8282\u70B9[${i.Data.Label}]\u6210\u529F`)}catch(n){e.Notification.Success(`\u7B7E\u51FA\u8282\u70B9[${i.Data.Label}]\u5931\u8D25: ${n.Message}`)}}static async Save(){let i=a.ActiveDesigner;if(i!=null)try{await i.SaveAsync(),e.Notification.Success("\u4FDD\u5B58\u6210\u529F")}catch(t){e.Notification.Error(`\u4FDD\u5B58\u5931\u8D25: ${t.Message}`)}}static async Delete(){let i=a.TreeController.FirstSelectedNode;if(i==null){e.Notification.Error("\u8BF7\u5148\u9009\u62E9\u5F85\u5220\u9664\u7684\u8282\u70B9");return}let t=i.Data.Type;try{let n=await C.Channel.Invoke("sys.DesignService.DeleteNode",[Math.floor(t)&4294967295,i.Data.Id]);a.OnDeleteNode(i,n),e.Notification.Success(`\u5220\u9664\u8282\u70B9[${i.Data.Label}]\u6210\u529F`)}catch(n){e.Notification.Error(`\u5220\u9664\u8282\u70B9[${i.Data.Label}]\u5931\u8D25: ${n.Message}`)}}static async Rename(){let i=a.TreeController.FirstSelectedNode;if(i==null){e.Notification.Error("\u8BF7\u5148\u9009\u62E9\u5F85\u91CD\u547D\u540D\u7684\u8282\u70B9");return}let t=0,n;if(i.Data.Type==I.ModelNode)switch(n=i.Data,n.ModelType){case d.ModelType.Entity:t=d.ModelReferenceType.EntityModel;break;case d.ModelType.Service:t=d.ModelReferenceType.ServiceModel;break;case d.ModelType.View:t=d.ModelReferenceType.ViewModel;break;default:e.Notification.Error("\u4E0D\u652F\u6301\u91CD\u547D\u540D\u7684\u8282\u70B9");return}else{e.Notification.Error("\u4E0D\u652F\u6301\u91CD\u547D\u540D\u7684\u8282\u70B9");return}let r=new Je(t,n.Label.Value,n.Id,n.Label.Value);await r.ShowAndWaitClose()||(n.Label.Value=r.GetNewName())}};let w=T;o(w,"NewEntityCommand",()=>new be().Show()),o(w,"NewServiceCommand",()=>new ze("Service").Show()),o(w,"NewViewCommand",()=>new ze("View").Show()),o(w,"CheckoutCommand",T.Checkout),o(w,"SaveCommand",T.Save),o(w,"RenameCommand",T.Rename),o(w,"DeleteCommand",T.Delete),o(w,"PublishCommand",()=>new xe().Show()),o(w,"NotImplCommand",()=>e.Notification.Error("\u6682\u672A\u5B9E\u73B0"));class Oe extends e.View{constructor(){super();o(this,"_bgColor",new e.Color(43,49,56));this.Child=new e.Container().Init({Height:e.State.op_Implicit_From(45),BgColor:e.State.op_Implicit_From(this._bgColor),Child:new e.Row().Init({Children:[new e.Container().Init({Width:e.State.op_Implicit_From(50)}),new e.Expanded().Init({Child:new e.MainMenu(Oe.BuildMenuItems()).Init({BackgroudColor:this._bgColor,Color:e.Colors.White})})]})})}static BuildMenuItems(){return[e.MenuItem.SubMenu("DataStore",e.Icons.Filled.Dns,[e.MenuItem.Item("Add DataStore",null,w.NotImplCommand),e.MenuItem.Item("Remove DataStore",null,w.NotImplCommand)]),e.MenuItem.SubMenu("New",e.Icons.Filled.CreateNewFolder,[e.MenuItem.Item("Application",e.Icons.Filled.Widgets,w.NotImplCommand),e.MenuItem.Item("Folder",e.Icons.Filled.Folder,w.NotImplCommand),e.MenuItem.Item("Entity",e.Icons.Filled.TableChart,w.NewEntityCommand),e.MenuItem.Item("Service",e.Icons.Filled.Settings,w.NewServiceCommand),e.MenuItem.Item("View",e.Icons.Filled.Wysiwyg,w.NewViewCommand),e.MenuItem.Item("Report",e.Icons.Filled.PieChart,w.NotImplCommand),e.MenuItem.Item("Enum",e.Icons.Filled.ViewList,w.NotImplCommand),e.MenuItem.Item("Permission",e.Icons.Filled.Lock,w.NotImplCommand)]),e.MenuItem.SubMenu("Models",e.Icons.Filled.Widgets,[e.MenuItem.Item("Save",e.Icons.Filled.Save,w.SaveCommand),e.MenuItem.Item("Checkout",e.Icons.Filled.CheckCircle,w.CheckoutCommand),e.MenuItem.Item("Rename",e.Icons.Filled.DriveFileRenameOutline,w.RenameCommand),e.MenuItem.Item("Delete",e.Icons.Filled.DeleteForever,w.DeleteCommand),e.MenuItem.Item("Publish",e.Icons.Filled.Publish,w.PublishCommand)]),e.MenuItem.Item("Tools",e.Icons.Filled.Handyman),e.MenuItem.Item("AppStore",e.Icons.Filled.Store),e.MenuItem.Item("About",e.Icons.Filled.Help)]}}class Dt extends e.View{constructor(){super(),this.Child=new e.Container().Init({Height:e.State.op_Implicit_From(25),BgColor:e.State.op_Implicit_From(new e.Color(4291585338)),Child:new e.Center().Init({Child:new e.Text(e.State.op_Implicit_From("enjoycode@icloud.com")).Init({TextColor:e.State.op_Implicit_From(e.Colors.White)})})})}}var Qe=(s=>(s[s.DesignTree=0]="DesignTree",s[s.Outline=1]="Outline",s[s.Toolbox=2]="Toolbox",s[s.Settings=3]="Settings",s))(Qe||{});class Et extends e.View{constructor(){super();o(this,"_buttonColor",e.State.op_Implicit_From(e.Colors.White));o(this,"_buttonSize",e.State.op_Implicit_From(25));this.Child=new e.Container().Init({Padding:e.State.op_Implicit_From(e.EdgeInsets.Only(5,0,0,0)),Width:e.State.op_Implicit_From(45),BgColor:e.State.op_Implicit_From(new e.Color(43,49,56)),Child:new e.Column().Init({Children:[new e.Expanded().Init({Child:new e.Column(e.HorizontalAlignment.Center,5).Init({Children:[this.BuildButton(e.Icons.Filled.Folder,0),this.BuildButton(e.Icons.Filled.AccountTree,1),this.BuildButton(e.Icons.Filled.Build,2),this.BuildButton(e.Icons.Filled.Settings,3)]})}),this.BuildButton(e.Icons.Filled.ArrowLeft)]})})}BuildButton(t,n=null){let r=this._buttonColor;return n!=null&&(r=this.Compute1(a.ActiveSidePad,l=>l==n?new e.Color(4283090410):new e.Color(4285167493))),new e.Button(null,e.State.op_Implicit_From(t)).Init({FontSize:this._buttonSize,TextColor:r,Style:e.ButtonStyle.Transparent,OnTap:l=>this.OnClick(n)})}OnClick(t){t!=null&&(a.ActiveSidePad.Value=t)}}class bt extends e.View{constructor(){super(),this.Child=new e.Row().Init({Children:[new Et,new e.Container().Init({DebugLabel:"SidePad",Padding:e.State.op_Implicit_From(e.EdgeInsets.All(5)),Width:e.State.op_Implicit_From(250),BgColor:e.State.op_Implicit_From(new e.Color(4294177779)),Child:new e.Conditional(a.ActiveSidePad).When(i=>i==0,()=>new Me).When(i=>i==1,()=>new xt).When(i=>i==2,()=>new Ot).When(i=>i==3,()=>new At)})]})}}class Me extends e.View{constructor(){super();o(this,"_searchKey",e.State.op_Implicit_From(""));o(this,"_hasLoadTree",!1);this.Child=new e.Column().Init({Children:[new e.Input(this._searchKey).Init({Prefix:new e.Icon(e.State.op_Implicit_From(e.Icons.Filled.Search))}),new e.TreeView(a.TreeController)]})}static BuildTreeNode(t,n){n.Icon=new e.Icon(e.State.op_Implicit_From(Me.GetIconForNode(t))),n.Label=new e.Text(t.Label),n.IsLeaf=t.Type==I.ModelNode||t.Type==I.DataStoreNode,n.IsExpanded=t.Type==I.DataStoreRootNode||t.Type==I.ApplicationRoot||t.Type==I.ApplicationNode}static GetIconForNode(t){switch(t.Type){case I.DataStoreNode:return e.Icons.Filled.Storage;case I.ApplicationNode:return e.Icons.Filled.Widgets;case I.ModelNode:return St.GetIconForModelType(t.ModelType);default:return e.Icons.Filled.Folder}}OnMounted(){super.OnMounted(),this.LoadDesignTree()}async LoadDesignTree(){if(!this._hasLoadTree){this._hasLoadTree=!0,a.TreeController.IsLoading=!0;try{let t=await C.Channel.Invoke("sys.DesignService.LoadDesignTree");a.TreeController.DataSource=t.RootNodes}catch(t){e.Notification.Error(`Can't load design tree: ${t.Message}`)}finally{a.TreeController.IsLoading=!1}}}}class xt extends e.View{constructor(){super();o(this,"NotSupported",new e.Center().Init({Child:new e.Text(e.State.op_Implicit_From("Not supported."))}));a.DesignerController.TabSelectChanged.Add(this.OnActiveDesignerChanged,this),this.Child=this.NotSupported}OnMounted(){this.BuildOutlineView()}OnActiveDesignerChanged(t){!this.IsMounted||this.BuildOutlineView()}BuildOutlineView(){let t=a.ActiveDesigner;if(je(t)){let r=t.GetOutlinePad();if(r!=null){this.Child=r,this.Invalidate(e.InvalidAction.Relayout);return}}this.Child!==this.NotSupported&&(this.Child=this.NotSupported,this.Invalidate(e.InvalidAction.Relayout))}}class Ot extends e.View{constructor(){super(),this.Child=new e.Text(e.State.op_Implicit_From("Toolbox"))}}class At extends e.View{constructor(){super(),this.Child=new e.Text(e.State.op_Implicit_From("Settings"))}}class ge extends e.View{constructor(){super(),this.Child=new e.Container().Init({Height:e.State.op_Implicit_From(190),Child:new e.TabView(a.BottomPadController,ge.BuildTab,ge.BuildBody,!1,40).Init({SelectedTabColor:e.Colors.White,TabBarBgColor:new e.Color(4294177779)})})}static BuildTab(i,t){let n=e.RxComputed.Make1(t,r=>r?e.Theme.FocusedColor:e.Colors.Black);return new e.Text(e.State.op_Implicit_From(i)).Init({TextColor:n})}static BuildBody(i){return i=="Problems"?new e.DataGrid(a.ProblemsController).Init({Columns:[new e.DataGridTextColumn("Position",t=>t.Position).Init({Width:e.ColumnWidth.Fixed(180)}),new e.DataGridTextColumn("Message",t=>t.Message)]}):i=="Usages"?new e.DataGrid(a.UsagesController).Init({Columns:[new e.DataGridTextColumn("Model",t=>t.ModelName),new e.DataGridTextColumn("Location",t=>t.Location)]}):new e.Container().Init({Padding:e.State.op_Implicit_From(e.EdgeInsets.All(10)),BgColor:e.State.op_Implicit_From(e.Colors.White),Child:new e.Text(e.State.op_Implicit_From(i))})}}class b extends e.View{constructor(){super();o(this,"_isOpenedAnyDesigner",e.State.op_Implicit_From(!1));a.TreeController.SelectionChanged.Add(b.OnTreeSelectionChanged),a.DesignerController.TabAdded.Add(this.OnDesignerOpened,this),a.DesignerController.TabClosed.Add(this.OnDesignerClosed,this),this.BgColor=e.State.op_Implicit_From(e.Colors.White),this.Child=new e.IfConditional(this._isOpenedAnyDesigner,()=>new e.TabView(a.DesignerController,b.BuildTab,b.BuildBody,!0,40).Init({SelectedTabColor:e.Colors.White,TabBarBgColor:new e.Color(4294177779)}),()=>new e.Center().Init({Child:new e.Text(e.State.op_Implicit_From("Welcome to AppBox!"))}))}static BuildTab(t,n){let r=e.RxComputed.Make1(n,l=>l?e.Theme.FocusedColor:e.Colors.Black);return new e.Text(t.Label).Init({TextColor:r})}static BuildBody(t){if(t.Type==I.ModelNode){let n=t;switch(n.ModelType){case d.ModelType.Entity:let r=new Ze(n);return t.Designer=r,r;case d.ModelType.View:let l=new we(n);return t.Designer=l,l;case d.ModelType.Service:let c=new Ce(n);return t.Designer=c,c}}return new e.Container().Init({Padding:e.State.op_Implicit_From(e.EdgeInsets.All(10)),BgColor:e.State.op_Implicit_From(e.Colors.White),Child:new e.Text(t.Label)})}OnDesignerOpened(t){this._isOpenedAnyDesigner.Value=a.DesignerController.Count>0}async OnDesignerClosed(t){if(this._isOpenedAnyDesigner.Value=a.DesignerController.Count>0,t.Designer=null,t.Type==I.ModelNode){let n=t;(n.ModelType==d.ModelType.Service||n.ModelType==d.ModelType.View)&&await C.Channel.Invoke("sys.DesignService.CloseDesigner",[Math.floor(t.Type)&4294967295,t.Id])}}static OnTreeSelectionChanged(){let t=a.TreeController.FirstSelectedNode;t!=null&&t.Data instanceof he&&a.OpenOrActiveDesigner(t.Data,null)}}const _=class{static get ActiveDesigner(){let i=_.DesignerController.SelectedIndex;return i<0?null:_.DesignerController.GetAt(i).Designer}static OnNewNode(i){let t=_.TreeController.InsertNode(i.NewNode,i.ParentNode,i.InsertIndex);_.TreeController.ExpandTo(t),_.TreeController.SelectNode(t)}static OnDeleteNode(i,t){_.DesignerController.Remove(i.Data),_.TreeController.RemoveNode(i)}static OnRenameDone(i,t,n){for(let r=0;r<_.DesignerController.Count;r++){let l=_.DesignerController.GetAt(r).Designer;if(l!=null&&je(l)){const c=l;n.Contains(c.ModelNode.Id)&&l.RefreshAsync()}}}static UpdateProblems(i,t){_.ProblemsController.DataSource=t}static UpdateUsages(i){_.UsagesController.DataSource=i,_.BottomPadController.SelectAt(1)}static OpenOrActiveDesigner(i,t){let n=_.DesignerController.IndexOf(i);n<0?_.DesignerController.Add(i):_.DesignerController.SelectAt(n),t!=null&&i.Designer.GotoDefinition(t)}static FindDesignNodeById(i){return _.TreeController.FindNode(n=>n.Id==i)?.Data}static GetAllEntityNodes(){let i=new u.List,t=_.TreeController.DataSource[1];for(const n of t.Children){let r=n.Children[0];_.LoopAddEntityNode(r,i)}return i}static LoopAddEntityNode(i,t){if(i instanceof he){const n=i;t.Add(n)}else if(i.Children!=null)for(const n of i.Children)_.LoopAddEntityNode(n,t)}};let a=_;o(a,"ActiveSidePad",e.State.op_Implicit_From(Qe.DesignTree)),o(a,"TreeController",new e.TreeController(Me.BuildTreeNode,i=>i.Children)),o(a,"DesignerController",new e.TabController(new u.List)),o(a,"BottomPadController",new e.TabController(new u.List().Init(["Problems","Usages","Output"]))),o(a,"ProblemsController",new e.DataGridController),o(a,"UsagesController",new e.DataGridController);class Ae{constructor(){o(this,"Name");o(this,"Children");o(this,"ModelId");o(this,"OrgUnits")}ReadFrom(i){this.Name=i.ReadString();let t=i.ReadVariant();if(t>=0){this.Children=new $e;for(let n=0;n<t;n++){let r=new Ae;r.ReadFrom(i),this.Children.Add(r)}}else{this.ModelId=i.ReadString(),t=i.ReadVariant(),this.OrgUnits=new $e;for(let n=0;n<t;n++)this.OrgUnits.Add(i.ReadGuid())}}WriteTo(i){throw new Error("\u672A\u5B9E\u73B0")}}class Bt{static async TryInit(){if(g.GetSerializer(y.DesignTree)!=null)return;const i=window.TreeSitter;await i.init();let t=await i.Language.load("/tree-sitter-c_sharp.wasm");st.Init(t),g.RegisterKnownType(y.EntityModelVO,!1,()=>new wt),g.RegisterKnownType(y.EntityFieldVO,!1,()=>new He),g.RegisterKnownType(y.EntityRefVO,!1,()=>new Ee),g.RegisterKnownType(y.EntitySetVO,!1,()=>new qe),g.RegisterKnownType(y.EntityMemberInfo,!1,()=>new _t),g.RegisterKnownType(y.DesignTree,!1,()=>new Nt),g.RegisterKnownType(y.NewNodeResult,!1,()=>new Re),g.RegisterKnownType(y.CodeProblem,!0,()=>new mt),g.RegisterKnownType(y.CompletionItem,!0,()=>new Rt),g.RegisterKnownType(y.ChangedModel,!0,()=>new ht),g.RegisterKnownType(y.FieldWithOrder,!0,()=>new lt),g.RegisterKnownType(y.ReferenceVO,!1,()=>new gt),g.RegisterKnownType(y.TextChange,!0,()=>new yt),g.RegisterKnownType(y.PermissionNode,!1,()=>new Ae)}}const We=class{async Execute(i){let t=i.Document.Tag,n=await C.Channel.Invoke("sys.DesignService.FormatDocument",[t]);if(!(n==null||n.length==0)){i.Document.StartUndoGroup();for(const r of n)i.Document.Replace(r.Offset,r.Length,r.Text??"");i.Document.EndUndoGroup()}}};let pe=We;o(pe,"Default",new We);const Ge=class{async Execute(i){let t=i.Document.Tag,n=i.Caret.Line,r=i.Caret.Column,l=await C.Channel.Invoke("sys.DesignService.GotoDefinition",[t,n,r]);if(l==null)return;let c=a.FindDesignNodeById(l.ModelId);c!=null&&a.OpenOrActiveDesigner(c,l)}static RunOnCodeEditor(i,t){let n=i.Document,r=n.OffsetToPosition(t.Offset),l=n.OffsetToPosition(t.Offset+t.Length);i.SetCaret(r.Line,r.Column),i.SetSelection(r.Clone(),l.Clone())}};let S=Ge;o(S,"Default",new Ge);class Xe{static BuildContextMenu(i){return[e.MenuItem.Item("Goto Definition",null,()=>S.Default.Execute(i)),e.MenuItem.Divider(),e.MenuItem.Item("Format Document",null,()=>pe.Default.Execute(i))]}}class Ye{constructor(i,t){o(this,"_targetType");o(this,"_targetId");o(this,"_submittingFlag",0);o(this,"_queue",new u.List);this._targetType=i,this._targetId=t}OnDocumentChanged(i){this._queue.Add(new vt(i.Offset,i.Length,i.Text)),this.StartSubmit()}async StartSubmit(){if(this._submittingFlag==0){for(this._submittingFlag=1;this._queue.length>0;){let i=this._queue[0];await C.Channel.Invoke("sys.DesignService.ChangeBuffer",[this._targetType,this._targetId,i.Offset,i.Length,i.Text]),this._queue.RemoveAt(0)}this._submittingFlag=0}}}class vt{constructor(i,t,n){o(this,"Offset");o(this,"Length");o(this,"Text");this.Offset=i,this.Length=t,this.Text=n}}const M=class extends e.Dialog{constructor(t){super();o(this,"_modelNode");o(this,"_name",e.State.op_Implicit_From(""));o(this,"_allowNull",e.State.op_Implicit_From(!1));o(this,"_memberType",e.State.op_Implicit_From(M.MemberTypes[0]));o(this,"_fieldType",e.State.op_Implicit_From(M.FieldTypes[0]));o(this,"_entityRefTarget",new e.Rx(null));o(this,"_entitySetTarget",new e.Rx(null));this._modelNode=t,this.Width=e.State.op_Implicit_From(380),this.Height=e.State.op_Implicit_From(280),this.Title.Value="New Entity Member"}BuildBody(){return new e.Container().Init({Padding:e.State.op_Implicit_From(e.EdgeInsets.All(20)),Child:new e.Column().Init({Children:[new e.Form().Init({LabelWidth:100,Padding:e.EdgeInsets.Only(5,5,5,0),Children:[new e.FormItem("Name:",new e.Input(this._name)),new e.FormItem("MemberType:",new e.Select(this._memberType).Init({Options:M.MemberTypes}))]}),new e.Conditional(this._memberType).When(t=>t=="EntityField",()=>new e.Form().Init({LabelWidth:100,Padding:e.EdgeInsets.Only(5,0,5,5),Children:[new e.FormItem("FieldType:",new e.Select(this._fieldType).Init({Options:M.FieldTypes})),new e.FormItem("AllowNull:",new e.Checkbox(this._allowNull))]})).When(t=>t=="EntityRef",()=>new e.Form().Init({LabelWidth:100,Padding:e.EdgeInsets.Only(5,0,5,5),Children:[new e.FormItem("Target:",new e.Select(this._entityRefTarget).Init({Options:a.GetAllEntityNodes().ToArray()})),new e.FormItem("AllowNull:",new e.Checkbox(this._allowNull))]})).When(t=>t=="EntitySet",()=>new e.Form().Init({LabelWidth:100,Padding:e.EdgeInsets.Only(5,0,5,5),Children:[new e.FormItem("Target:",new e.Select(this._entitySetTarget).Init({OptionsAsyncGetter:C.Channel.Invoke("sys.DesignService.GetAllEntityRefs",[this._modelNode.Id])}))]}))]})})}GetMemberTypeValue(){switch(this._memberType.Value){case"EntityField":return d.EntityMemberType.EntityField;case"EntityRef":return d.EntityMemberType.EntityRef;case"EntitySet":return d.EntityMemberType.EntitySet;default:throw new u.Exception}}GetFieldTypeValue(){switch(this._fieldType.Value){case"String":return d.EntityFieldType.String;case"Int":return d.EntityFieldType.Int;case"Long":return d.EntityFieldType.Long;case"Float":return d.EntityFieldType.Float;case"Double":return d.EntityFieldType.Double;default:throw new u.NotImplementedException}}GetRefModelIds(){return this._entityRefTarget.Value==null?[]:[this._entityRefTarget.Value.Id]}GetArgs(){let t=this.GetMemberTypeValue();if(t==d.EntityMemberType.EntityField)return[this._modelNode.Id,this._name.Value,t,this.GetFieldTypeValue(),this._allowNull.Value];if(t==d.EntityMemberType.EntityRef)return[this._modelNode.Id,this._name.Value,t,this.GetRefModelIds(),this._allowNull.Value];if(t==d.EntityMemberType.EntitySet)return[this._modelNode.Id,this._name.Value,t,this._entitySetTarget.Value.ModelId,this._entitySetTarget.Value.MemberId];throw new u.NotImplementedException}};let D=M;o(D,"MemberTypes",["EntityField","EntityRef","EntitySet"]),o(D,"FieldTypes",["String","Int","Long","Float","Double"]);class Lt extends e.Dialog{constructor(t){super();o(this,"_entityModel");o(this,"_selected",new e.Rx(null));o(this,"_orderByDesc",e.State.op_Implicit_From(!1));this._entityModel=t,this.Width=e.State.op_Implicit_From(380),this.Height=e.State.op_Implicit_From(200),this.Title.Value="EntityFieldWithOrder"}BuildBody(){return new e.Container().Init({Padding:e.State.op_Implicit_From(e.EdgeInsets.All(20)),Child:new e.Form().Init({Children:[new e.FormItem("EntityField:",new e.Select(this._selected).Init({Options:this._entityModel.Members.Where(t=>t.Type==d.EntityMemberType.EntityField).ToArray()})),new e.FormItem("OrderByDesc:",new e.Checkbox(this._orderByDesc))]})})}GetResult(){return this._selected.Value==null?null:new d.FieldWithOrder(this._selected.Value.Id,this._orderByDesc.Value)}}class Vt extends e.RxObject{constructor(t){super();o(this,"Name");o(this,"FieldType");o(this,"Comment");this._target=t,this.Name=new e.RxProperty(()=>this.Target.Name),this.FieldType=new e.RxProperty(()=>this.Target.FieldType),this.Comment=new e.RxProperty(()=>this.Target.Comment??"",n=>this.Target.Comment=n)}}const Se=class extends e.View{constructor(t,n){super();o(this,"_entityModel");o(this,"_selectedMember");o(this,"_rxEntityField");this._entityModel=t,this._selectedMember=this.Bind(n,e.BindingOptions.None),this._rxEntityField=new Vt(this._selectedMember.Value);let r=this._selectedMember.AsStateOfBool(l=>l!=null&&l.Type==d.EntityMemberType.EntityField);this.Child=new e.Column(e.HorizontalAlignment.Left).Init({Children:[new e.Text(e.State.op_Implicit_From("Entity Properties:")).Init({FontWeight:e.State.op_Implicit_From(CanvasKit.FontWeight.Bold)}),new e.Form().Init({LabelWidth:Se._labelWidth,Children:[new e.FormItem("DataStoreKind:",new e.Input(e.State.op_Implicit_From("SqlStore")).Init({Readonly:e.State.op_Implicit_From(!0)})),new e.FormItem("DataStoreName:",new e.Input(e.State.op_Implicit_From("Default")).Init({Readonly:e.State.op_Implicit_From(!0)})),new e.FormItem("Comment:",new e.Input(e.State.op_Implicit_From("")))]}),new e.IfConditional(r,()=>new e.Text(e.State.op_Implicit_From("EntityField Properties:")).Init({FontWeight:e.State.op_Implicit_From(CanvasKit.FontWeight.Bold)})),new e.IfConditional(r,()=>new e.Form().Init({LabelWidth:Se._labelWidth,Children:[new e.FormItem("Name:",new e.Input(this._rxEntityField.Name)),new e.FormItem("FieldType:",new e.Input(this._rxEntityField.FieldType.AsStateOfString(l=>d.EntityFieldType[l]))),new e.FormItem("Comment:",new e.Input(this._rxEntityField.Comment))]}))]})}OnStateChanged(t,n){if(t===this._selectedMember){this._selectedMember.Value!=null&&this._selectedMember.Value.Type==d.EntityMemberType.EntityField&&(this._rxEntityField.Target=this._selectedMember.Value);return}super.OnStateChanged(t,n)}};let Ie=Se;o(Ie,"_labelWidth",120);class Be extends e.View{constructor(i,t,n){super(),this.Child=new e.Row().Init({Children:[new e.Expanded().Init({Child:new e.DataGrid(t).Init({Columns:[new e.DataGridTextColumn("Name",r=>r.Name).Init({Width:e.ColumnWidth.Fixed(150)}),new e.DataGridTextColumn("Type",Be.MemberTypeToString).Init({Width:e.ColumnWidth.Fixed(200)}),new e.DataGridCheckboxColumn("AllowNull",r=>r.AllowNull).Init({Width:e.ColumnWidth.Fixed(90)}),new e.DataGridTextColumn("Comment",r=>r.Comment??"")]})}),new e.Container().Init({BgColor:e.State.op_Implicit_From(new e.Color(4294177779)),Width:e.State.op_Implicit_From(280),Child:new Ie(i,n)})]})}static MemberTypeToString(i){return i.Type==d.EntityMemberType.EntityField?`${d.EntityMemberType[i.Type]} - ${d.EntityFieldType[i.FieldType]}`:d.EntityMemberType[i.Type]}}class Pt extends e.View{constructor(t,n){super();o(this,"_entityModel");o(this,"_modelId");o(this,"_pkController",new e.DataGridController);o(this,"_idxController",new e.DataGridController);this._entityModel=t,this._modelId=n,this._pkController.DataSource=this._entityModel.SqlStoreOptions.PrimaryKeys,this._idxController.DataSource=this._entityModel.SqlStoreOptions.Indexes,this.Child=new e.Container().Init({Padding:e.State.op_Implicit_From(e.EdgeInsets.All(8)),Child:new e.Row(e.VerticalAlignment.Top,10).Init({Children:[new e.Expanded(this.BuildPrimaryKeysPannel()),new e.Expanded(this.BuildIndexesPannel())]})})}BuildPrimaryKeysPannel(){return new e.Card().Init({Padding:e.State.op_Implicit_From(e.EdgeInsets.All(10)),Child:new e.Column(e.HorizontalAlignment.Left,10).Init({Children:[new e.Text(e.State.op_Implicit_From("Primary Keys:")).Init({FontSize:e.State.op_Implicit_From(20),FontWeight:e.State.op_Implicit_From(CanvasKit.FontWeight.Bold)}),new e.ButtonGroup().Init({Children:[new e.Button(e.State.op_Implicit_From("Add"),e.State.op_Implicit_From(e.Icons.Filled.Add)).Init({OnTap:this.OnAddPk.bind(this)}),new e.Button(e.State.op_Implicit_From("Remove"),e.State.op_Implicit_From(e.Icons.Filled.Remove)).Init({OnTap:this.OnRemovePk.bind(this)})]}),new e.DataGrid(this._pkController).Init({Columns:[new e.DataGridTextColumn("Name",t=>this._entityModel.Members.First(n=>n.Id==t.MemberId).Name),new e.DataGridCheckboxColumn("OrderByDesc",t=>t.OrderByDesc)]})]})})}BuildIndexesPannel(){return new e.Card().Init({Padding:e.State.op_Implicit_From(e.EdgeInsets.All(10)),Child:new e.Column(e.HorizontalAlignment.Left,10).Init({Children:[new e.Text(e.State.op_Implicit_From("Indexes:")).Init({FontSize:e.State.op_Implicit_From(20),FontWeight:e.State.op_Implicit_From(CanvasKit.FontWeight.Bold)}),new e.ButtonGroup().Init({Children:[new e.Button(e.State.op_Implicit_From("Add"),e.State.op_Implicit_From(e.Icons.Filled.Add)),new e.Button(e.State.op_Implicit_From("Remove"),e.State.op_Implicit_From(e.Icons.Filled.Remove))]}),new e.DataGrid(this._idxController).Init({Columns:[new e.DataGridTextColumn("Name",t=>t.Name),new e.DataGridTextColumn("Fields",t=>this.GetIndexesFieldsList(t)),new e.DataGridCheckboxColumn("Unique",t=>!0)]})]})})}GetIndexesFieldsList(t){let n="";for(let r=0;r<t.Fields.length;r++)r!=0&&(n+=", "),n+=this._entityModel.Members.First(l=>l.Id==t.Fields[r].MemberId).Name,t.Fields[r].OrderByDesc&&(n+=" OrderByDesc");return n}async OnAddPk(t){let n=new Lt(this._entityModel);if(await n.ShowAndWaitClose())return;let l=n.GetResult();l!=null&&(this._pkController.Add(l.Clone()),this.ChangePrimaryKeys())}OnRemovePk(t){this._pkController.CurrentRowIndex<0||(this._pkController.RemoveAt(this._pkController.CurrentRowIndex),this.ChangePrimaryKeys())}async ChangePrimaryKeys(){let t=[this._modelId,this._entityModel.SqlStoreOptions.PrimaryKeys.length==0?null:this._entityModel.SqlStoreOptions.PrimaryKeys.ToArray()];try{await C.Channel.Invoke("sys.DesignService.ChangePrimaryKeys",t)}catch(n){e.Notification.Error(`Change primary keys error: ${n.Message}`)}}}var ae;class Ze extends e.View{constructor(t){super();m(this,ae,void 0);o(this,"_activePad",e.State.op_Implicit_From(0));o(this,"_entityModel");o(this,"_pendingGoto");o(this,"_membersController",new e.DataGridController);o(this,"_selectedMember");this.ModelNode=t,this._selectedMember=this._membersController.ObserveCurrentRow(),this.Child=new e.Column().Init({Children:[this.BuildActionBar(),new e.Expanded().Init({Child:this.BuildBody()})]})}get ModelNode(){return h(this,ae)}set ModelNode(t){p(this,ae,t)}BuildActionBar(){return new e.Container().Init({BgColor:e.State.op_Implicit_From(new e.Color(4294309882)),Height:e.State.op_Implicit_From(45),Padding:e.State.op_Implicit_From(e.EdgeInsets.All(8)),Child:new e.Row(e.VerticalAlignment.Middle,10).Init({Children:[new e.ButtonGroup().Init({Children:[new e.Button(e.State.op_Implicit_From("Members")).Init({Width:e.State.op_Implicit_From(75),OnTap:t=>this._activePad.Value=0}),new e.Button(e.State.op_Implicit_From("Options")).Init({Width:e.State.op_Implicit_From(75),OnTap:t=>this._activePad.Value=1}),new e.Button(e.State.op_Implicit_From("Data")).Init({Width:e.State.op_Implicit_From(75)})]}),new e.IfConditional(this._activePad.AsStateOfBool(t=>t==0),()=>new e.ButtonGroup().Init({Children:[new e.Button(e.State.op_Implicit_From("Add"),e.State.op_Implicit_From(e.Icons.Filled.Add)).Init({OnTap:this.OnAddMember.bind(this)}),new e.Button(e.State.op_Implicit_From("Remove"),e.State.op_Implicit_From(e.Icons.Filled.Delete)).Init({OnTap:this.OnDeleteMember.bind(this)}),new e.Button(e.State.op_Implicit_From("Rename"),e.State.op_Implicit_From(e.Icons.Filled.Edit)).Init({OnTap:this.OnRenameMember.bind(this)}),new e.Button(e.State.op_Implicit_From("Usages"),e.State.op_Implicit_From(e.Icons.Filled.Link)).Init({OnTap:this.OnFindUsages.bind(this)})]}))]})})}BuildBody(){return new e.FutureBuilder(C.Channel.Invoke("sys.DesignService.OpenEntityModel",[this.ModelNode.Id]),(t,n)=>n!=null?(e.Notification.Error(`\u65E0\u6CD5\u52A0\u8F7D\u5B9E\u4F53\u6A21\u578B: ${n.Message}`),null):(this._entityModel=t,this._membersController.DataSource=this._entityModel.Members.Where(r=>!r.IsForeignKeyMember).ToList(),this._pendingGoto!=null&&(this.GotoDefinitionInternal(this._pendingGoto),this._pendingGoto=null),new e.Conditional(this._activePad).When(r=>r==0,()=>new Be(this._entityModel,this._membersController,this._selectedMember)).When(r=>r==1,()=>new Pt(this._entityModel,this.ModelNode.Id))))}async OnAddMember(t){let n=new D(this.ModelNode);if(!await n.ShowAndWaitClose())try{let l=await C.Channel.Invoke("sys.DesignService.NewEntityMember",n.GetArgs());for(const c of l){if(c.IsForeignKeyMember){this._entityModel.Members.Add(c);continue}this._membersController.Add(c)}}catch(l){e.Notification.Error(`\u65B0\u5EFA\u5B9E\u4F53\u6210\u5458\u9519\u8BEF: ${l.Message}`)}}async OnDeleteMember(t){if(this._selectedMember.Value==null)return;let n=[this.ModelNode.Id,this._selectedMember.Value.Name];try{await C.Channel.Invoke("sys.DesignService.DeleteEntityMember",n);let r=this._selectedMember.Value;if(r instanceof Ee){const l=r;if(l.IsAggregationRef)throw new u.NotImplementedException;for(const c of l.FKMemberIds){let Ne=this._entityModel.Members.First(ke=>ke.Id==c);this._entityModel.Members.Remove(Ne)}}this._membersController.Remove(r)}catch(r){e.Notification.Error(`Delete member error: ${r.Message}`)}}async OnRenameMember(t){if(this._selectedMember.Value==null)return;let n=this._selectedMember.Value.Name,r=`${this.ModelNode.Label}.${n}`,l=new Je(d.ModelReferenceType.EntityMember,r,this.ModelNode.Id,n);await l.ShowAndWaitClose()||(this._selectedMember.Value.Name=l.GetNewName(),this._membersController.Refresh(),this._selectedMember.NotifyValueChanged())}async OnFindUsages(t){if(this._selectedMember.Value==null)return;let n=[d.ModelReferenceType.EntityMember,this.ModelNode.Id,this._selectedMember.Value.Name];try{let r=await C.Channel.Invoke("sys.DesignService.FindUsages",n);a.UpdateUsages(r)}catch(r){e.Notification.Error(`Delete member error: ${r.Message}`)}}GetOutlinePad(){return null}GotoDefinition(t){u.IsNullOrEmpty(t.Location)||(this._entityModel==null?this._pendingGoto=t:this.GotoDefinitionInternal(t))}GotoDefinitionInternal(t){let n=this._entityModel.Members.FirstOrDefault(r=>r.Name==t.Location);this._selectedMember.Value=n}SaveAsync(){return C.Channel.Invoke("sys.DesignService.SaveModel",[this.ModelNode.Id])}RefreshAsync(){return Promise.resolve()}}ae=new WeakMap,o(Ze,"$meta_AppBoxDesign_IModelDesigner",!0);var ue;const Fe=class extends e.View{constructor(t){super();m(this,ue,void 0);o(this,"_codeEditorController");o(this,"_codeSyncService");o(this,"_delayDocChangedTask");o(this,"_hasLoadSourceCode",!1);o(this,"_pendingGoto");this.ModelNode=t,this._codeEditorController=new _e.CodeEditorController(`${t.Label}.cs`,"",E.Default,t.Id),this._codeEditorController.ContextMenuBuilder=Xe.BuildContextMenu,this._codeSyncService=new Ye(0,t.Id),this._delayDocChangedTask=new e.DelayTask(300,this.RunDelayTask.bind(this)),this.Child=Fe.BuildEditor(this._codeEditorController)}get ModelNode(){return h(this,ue)}set ModelNode(t){p(this,ue,t)}static BuildEditor(t){return new e.Column().Init({Children:[Fe.BuildActionBar(),new e.Expanded().Init({Child:new _e.CodeEditorWidget(t)})]})}static BuildActionBar(){return new e.Container().Init({BgColor:e.State.op_Implicit_From(new e.Color(4282137660)),Height:e.State.op_Implicit_From(40),Padding:e.State.op_Implicit_From(e.EdgeInsets.Only(15,8,15,8)),Child:new e.Row(e.VerticalAlignment.Middle,10).Init({Children:[new e.Button(e.State.op_Implicit_From("Run")).Init({Width:e.State.op_Implicit_From(75)}),new e.Button(e.State.op_Implicit_From("Debug")).Init({Width:e.State.op_Implicit_From(75)})]})})}OnMounted(){super.OnMounted(),this.TryLoadSourceCode()}async TryLoadSourceCode(){if(this._hasLoadSourceCode)return;this._hasLoadSourceCode=!0;let t=await C.Channel.Invoke("sys.DesignService.OpenCodeModel",[this.ModelNode.Id]);this._codeEditorController.Document.TextContent=t,this._codeEditorController.Document.DocumentChanged.Add(this.OnDocumentChanged,this),this._pendingGoto!=null&&(S.RunOnCodeEditor(this._codeEditorController,this._pendingGoto),this._pendingGoto=null)}OnDocumentChanged(t){this._codeSyncService.OnDocumentChanged(t),this._delayDocChangedTask.Run()}async RunDelayTask(){try{let t=await C.Channel.Invoke("sys.DesignService.GetProblems",[!1,this.ModelNode.Id]);a.UpdateProblems(this.ModelNode,t)}catch(t){e.Notification.Error(`GetProblems error: ${t.Message}`)}}Dispose(){super.Dispose(),this._hasLoadSourceCode&&this._codeEditorController.Document.DocumentChanged.Remove(this.OnDocumentChanged,this)}GetOutlinePad(){return null}GotoDefinition(t){if(t.Offset<0)return;this._codeEditorController.Document.TextLength==0?this._pendingGoto=t:S.RunOnCodeEditor(this._codeEditorController,t)}SaveAsync(){return C.Channel.Invoke("sys.DesignService.SaveModel",[this.ModelNode.Id])}async RefreshAsync(){let t=await C.Channel.Invoke("sys.DesignService.OpenCodeModel",[this.ModelNode.Id]);this._codeEditorController.Document.DocumentChanged.Remove(this.OnDocumentChanged,this),this._codeEditorController.Document.TextContent=t,this._codeEditorController.Document.DocumentChanged.Add(this.OnDocumentChanged,this)}};let Ce=Fe;ue=new WeakMap,o(Ce,"$meta_AppBoxDesign_IModelDesigner",!0);class ve{constructor(i){o(this,"Widget");o(this,"Children");this.Widget=i,this.Children=new u.List,this.Widget.VisitChildren(t=>(this.Children.Add(new ve(t)),!1))}}class Wt{constructor(i){o(this,"ModelNode");o(this,"_invalidateAction");o(this,"_refreshOutlineAction");o(this,"CurrentWidget");this.ModelNode=i}set InvalidateAction(i){this._invalidateAction=i}get RefreshOutlineAction(){return this._refreshOutlineAction}set RefreshOutlineAction(i){this._refreshOutlineAction=i}Invalidate(){this._invalidateAction?.call(this)}GetWidgetTree(){return this.CurrentWidget==null?null:new ve(this.CurrentWidget)}}class Le extends e.View{constructor(t){super();o(this,"_previewController");o(this,"_treeController",new e.TreeController(Le.BuildTreeNode,t=>t.Children));o(this,"_searchKey",e.State.op_Implicit_From(""));o(this,"_inspector",null);this._previewController=t,this._treeController.SelectionChanged.Add(this.OnSelectedWidget,this),this.BuildWidgetTree(),this.Child=new e.Column().Init({Children:[new e.Input(this._searchKey).Init({Prefix:new e.Icon(e.State.op_Implicit_From(e.Icons.Filled.Search))}),new e.TreeView(this._treeController)]})}OnMounted(){this._previewController.RefreshOutlineAction=this.BuildWidgetTree.bind(this)}OnUnmounted(){this.ClearInspector(),this._previewController.RefreshOutlineAction=null}static BuildTreeNode(t,n){n.Icon=new e.Icon(e.State.op_Implicit_From(e.Icons.Filled.Folder)),n.Label=new e.Text(e.State.op_Implicit_From(t.Widget.toString())),n.IsLeaf=t.Children.length==0,n.IsExpanded=!n.IsLeaf}BuildWidgetTree(){this.ClearInspector(),this._treeController.DataSource=new u.List().Init([this._previewController.GetWidgetTree()])}ClearInspector(){this._inspector?.Remove(),this._inspector=null}OnSelectedWidget(){if(this._treeController.FirstSelectedNode==null){this.ClearInspector();return}this._inspector=e.Inspector.Show(this._treeController.FirstSelectedNode.Data.Widget)}}class Gt extends e.View{constructor(t){super();o(this,"_scale",e.Matrix4.CreateIdentity());this.Child=new e.Container().Init({BgColor:e.State.op_Implicit_From(new e.Color(4288848546)),Padding:e.State.op_Implicit_From(e.EdgeInsets.All(10)),Child:new e.Card().Init({Elevation:e.State.op_Implicit_From(10),Child:new e.Transform(this._scale.Clone()).Init({Child:new ct(t)})})})}}var ce;const fe=class extends e.View{constructor(t){super();m(this,ce,void 0);o(this,"_codeEditorController");o(this,"_codeSyncService");o(this,"_previewController");o(this,"_delayDocChangedTask");o(this,"_hasLoadSourceCode",!1);o(this,"_pendingGoto");this.ModelNode=t,this._previewController=new Wt(t),this._codeEditorController=new _e.CodeEditorController(`${t.Label}.cs`,"",E.Default,t.Id),this._codeEditorController.ContextMenuBuilder=Xe.BuildContextMenu,this._codeSyncService=new Ye(0,t.Id),this._delayDocChangedTask=new e.DelayTask(300,this.RunDelayTask.bind(this)),this.Child=new e.Row().Init({Children:[new e.Expanded(fe.BuildEditor(this._codeEditorController),2),new e.Expanded(new Gt(this._previewController),1)]})}get ModelNode(){return h(this,ce)}set ModelNode(t){p(this,ce,t)}static BuildEditor(t){return new e.Column().Init({Children:[fe.BuildActionBar(),new e.Expanded().Init({Child:new _e.CodeEditorWidget(t)})]})}static BuildActionBar(){return new e.Container().Init({BgColor:e.State.op_Implicit_From(new e.Color(4282137660)),Height:e.State.op_Implicit_From(40),Padding:e.State.op_Implicit_From(e.EdgeInsets.Only(15,8,15,8)),Child:new e.Row(e.VerticalAlignment.Middle,10).Init({Children:[new e.Button(e.State.op_Implicit_From("Preview")).Init({Width:e.State.op_Implicit_From(75)}),new e.Button(e.State.op_Implicit_From("Debug")).Init({Width:e.State.op_Implicit_From(75)})]})})}OnMounted(){super.OnMounted(),this.TryLoadSourceCode()}async TryLoadSourceCode(){if(this._hasLoadSourceCode)return;this._hasLoadSourceCode=!0;let t=await C.Channel.Invoke("sys.DesignService.OpenCodeModel",[this.ModelNode.Id]);this._codeEditorController.Document.TextContent=t,this._codeEditorController.Document.DocumentChanged.Add(this.OnDocumentChanged,this),this._pendingGoto!=null&&(S.RunOnCodeEditor(this._codeEditorController,this._pendingGoto),this._pendingGoto=null)}OnDocumentChanged(t){this._codeSyncService.OnDocumentChanged(t),this._delayDocChangedTask.Run()}async RunDelayTask(){let t=await C.Channel.Invoke("sys.DesignService.GetProblems",[!1,this.ModelNode.Id]);a.UpdateProblems(this.ModelNode,t),t.Any(n=>n.IsError)||this._previewController.Invalidate()}Dispose(){super.Dispose(),this._hasLoadSourceCode&&this._codeEditorController.Document.DocumentChanged.Remove(this.OnDocumentChanged,this)}GetOutlinePad(){return new Le(this._previewController)}GotoDefinition(t){if(t.Offset<0)return;this._codeEditorController.Document.TextLength==0?this._pendingGoto=t:S.RunOnCodeEditor(this._codeEditorController,t)}SaveAsync(){return C.Channel.Invoke("sys.DesignService.SaveModel",[this.ModelNode.Id])}async RefreshAsync(){let t=await C.Channel.Invoke("sys.DesignService.OpenCodeModel",[this.ModelNode.Id]);this._codeEditorController.Document.DocumentChanged.Remove(this.OnDocumentChanged,this),this._codeEditorController.Document.TextContent=t,this._codeEditorController.Document.DocumentChanged.Add(this.OnDocumentChanged,this)}};let we=fe;ce=new WeakMap,o(we,"$meta_AppBoxDesign_IModelDesigner",!0);class kt extends e.View{constructor(){super();o(this,"_userName",e.State.op_Implicit_From("Admin"));o(this,"_password",e.State.op_Implicit_From("760wb"));o(this,"_inputSize",e.State.op_Implicit_From(20));this.Child=new e.Center().Init({Child:new e.Card().Init({Width:e.State.op_Implicit_From(400),Height:e.State.op_Implicit_From(330),Elevation:e.State.op_Implicit_From(20),Child:this.BuildLoginForm()})})}BuildLoginForm(){return new e.Container().Init({Padding:e.State.op_Implicit_From(e.EdgeInsets.All(30)),Child:new e.Column(e.HorizontalAlignment.Center,30).Init({Children:[new e.Text(e.State.op_Implicit_From("Welcome")).Init({FontSize:e.State.op_Implicit_From(50)}),new e.Input(this._userName).Init({HintText:"Account",FontSize:this._inputSize,Prefix:new e.Icon(e.State.op_Implicit_From(e.Icons.Filled.Person)).Init({Size:this._inputSize})}),new e.Input(this._password).Init({IsObscure:!0,HintText:"Password",FontSize:this._inputSize,Prefix:new e.Icon(e.State.op_Implicit_From(e.Icons.Filled.Lock)).Init({Size:this._inputSize})}),new e.Button(e.State.op_Implicit_From("Login")).Init({Width:e.State.op_Implicit_From(120),OnTap:t=>this.OnLogin()})]})})}async OnLogin(){try{await Bt.TryInit(),await C.Channel.Login(this._userName.Value,this._password.Value),this.CurrentNavigator.Push("IDE")}catch(t){e.Notification.Error(`\u767B\u5F55\u9519\u8BEF: ${t.Message}`)}}}class Kt extends e.View{constructor(){super(),this.Child=new e.Column().Init({Children:[new Oe,new e.Expanded().Init({Child:new e.Row().Init({Children:[new bt,new e.Expanded().Init({Child:new e.Column().Init({Children:[new e.Expanded().Init({Child:new b}),new ge]})})]})}),new Dt]})}}class $t extends e.View{constructor(){super();let i=new e.Navigator(new u.List().Init([new e.Route("Login",async t=>new kt),new e.Route("IDE",async t=>new Kt),new e.Route("about",async t=>new e.Text(e.State.op_Implicit_From("About")))]));this.Child=new e.RouteView(i)}}it();nt();ot.Init(new rt);e.WebApplication.Run(()=>new $t);
